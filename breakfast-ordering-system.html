<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—©é¤åº—é»é¤ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* é ‚éƒ¨å°èˆª */
        .header {
            background-color: #2c974b;
            color: white;
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 24px;
        }

        /* æ¨™ç±¤é  */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background-color: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tab {
            padding: 10px 20px;
            background-color: #f0f0f0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .tab.active {
            background-color: #2c974b;
            color: white;
        }

        /* å…§å®¹å€åŸŸ */
        .content {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* èœå–®å€åŸŸ */
        .menu-categories {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .category-btn {
            padding: 8px 16px;
            background-color: #e9ecef;
            border: 2px solid transparent;
            border-radius: 20px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .category-btn.active {
            background-color: #ff6b35;
            color: white;
            border-color: #ff6b35;
        }

        /* èœå–®é …ç›® */
        .menu-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .menu-item {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .menu-item:hover {
            border-color: #ff6b35;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .menu-item h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: #333;
        }

        .menu-item .price {
            font-size: 20px;
            color: #ff6b35;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .add-btn {
            width: 100%;
            padding: 10px;
            background-color: #2c974b;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .add-btn:hover {
            background-color: #22753a;
        }

        /* è³¼ç‰©è»Š */
        .cart {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #ff6b35;
            color: white;
            padding: 15px 25px;
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: bold;
            z-index: 1000;
        }

        .cart-count {
            background-color: white;
            color: #ff6b35;
            padding: 2px 8px;
            border-radius: 15px;
            font-size: 14px;
        }

        /* è³¼ç‰©è»Šè©³æƒ… */
        .cart-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 2000;
        }

        .cart-content {
            position: absolute;
            right: 0;
            top: 0;
            width: 400px;
            height: 100%;
            background-color: white;
            padding: 20px;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .cart-content {
                width: 100%;
            }
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-btn {
            width: 30px;
            height: 30px;
            border: 1px solid #ddd;
            background-color: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quantity-btn:hover {
            background-color: #f0f0f0;
        }

        /* çµ±è¨ˆå€åŸŸ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e9ecef;
        }

        .stat-card h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            color: #2c974b;
        }

        /* å ±è¡¨å€åŸŸ */
        .report-section {
            margin-top: 30px;
        }

        .report-section h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .report-table th,
        .report-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .report-table th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #333;
        }

        .report-table tr:hover {
            background-color: #f8f9fa;
        }

        /* æŒ‰éˆ•çµ„ */
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background-color: #2c974b;
            color: white;
        }

        .btn-primary:hover {
            background-color: #22753a;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        /* å‹•ç•« */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* GitHub åŒæ­¥ç‹€æ…‹ */
        .sync-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 5px;
            background-color: #28a745;
            color: white;
            display: none;
            z-index: 3000;
        }

        .sync-status.show {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
            }
            to {
                transform: translateX(0);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ³ æ—©é¤åº—é»é¤ç³»çµ±</h1>
            <div id="currentTime"></div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('order')">é»é¤</button>
            <button class="tab" onclick="showTab('stats')">ä»Šæ—¥çµ±è¨ˆ</button>
            <button class="tab" onclick="showTab('reports')">å ±è¡¨</button>
            <button class="tab" onclick="showTab('settings')">è¨­å®š</button>
        </div>

        <!-- é»é¤å€åŸŸ -->
        <div id="orderTab" class="content">
            <div class="menu-categories">
                <button class="category-btn active" onclick="showCategory('all')">å…¨éƒ¨</button>
                <button class="category-btn" onclick="showCategory('fried')">ç‚¸ç‰©å€</button>
                <button class="category-btn" onclick="showCategory('egg')">è›‹é¤…å€</button>
                <button class="category-btn" onclick="showCategory('bun')">é¥…é ­å€</button>
                <button class="category-btn" onclick="showCategory('rice')">é£¯ç³°å€</button>
                <button class="category-btn" onclick="showCategory('drink')">é£²æ–™å€</button>
            </div>

            <div class="menu-items" id="menuItems"></div>
        </div>

        <!-- çµ±è¨ˆå€åŸŸ -->
        <div id="statsTab" class="content" style="display: none;">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>ä»Šæ—¥ç‡Ÿæ¥­é¡</h3>
                    <div class="value" id="todayRevenue">NT$0</div>
                </div>
                <div class="stat-card">
                    <h3>è¨‚å–®æ•¸é‡</h3>
                    <div class="value" id="orderCount">0</div>
                </div>
                <div class="stat-card">
                    <h3>å¹³å‡è¨‚å–®é‡‘é¡</h3>
                    <div class="value" id="avgOrder">NT$0</div>
                </div>
                <div class="stat-card">
                    <h3>ç†±éŠ·å•†å“</h3>
                    <div class="value" id="topItem">-</div>
                </div>
            </div>

            <div class="report-section">
                <h2>å„é¡åˆ¥éŠ·å”®çµ±è¨ˆ</h2>
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>é¡åˆ¥</th>
                            <th>éŠ·å”®æ•¸é‡</th>
                            <th>ç‡Ÿæ¥­é¡</th>
                            <th>ä½”æ¯”</th>
                        </tr>
                    </thead>
                    <tbody id="categoryStats"></tbody>
                </table>
            </div>

            <div class="report-section">
                <h2>ç†±éŠ·å•†å“æ’è¡Œ</h2>
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>æ’å</th>
                            <th>å•†å“åç¨±</th>
                            <th>éŠ·å”®æ•¸é‡</th>
                            <th>ç‡Ÿæ¥­é¡</th>
                        </tr>
                    </thead>
                    <tbody id="topItems"></tbody>
                </table>
            </div>

            <div class="report-section">
                <h2>å®¢æˆ¶æ¶ˆè²»çµ±è¨ˆ</h2>
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>å®¢æˆ¶å§“å</th>
                            <th>è¨‚å–®æ•¸</th>
                            <th>æ¶ˆè²»é‡‘é¡</th>
                            <th>å¹³å‡æ¶ˆè²»</th>
                        </tr>
                    </thead>
                    <tbody id="customerStats"></tbody>
                </table>
            </div>
        </div>

        <!-- å ±è¡¨å€åŸŸ -->
        <div id="reportsTab" class="content" style="display: none;">
            <h2>éŠ·å”®å ±è¡¨</h2>
            <div class="button-group">
                <button class="btn btn-primary" onclick="generateDailyReport()">æ—¥å ±è¡¨</button>
                <button class="btn btn-primary" onclick="generateWeeklyReport()">é€±å ±è¡¨</button>
                <button class="btn btn-primary" onclick="generateMonthlyReport()">æœˆå ±è¡¨</button>
                <button class="btn btn-secondary" onclick="exportToCSV()">åŒ¯å‡ºCSV</button>
                <button class="btn btn-secondary" onclick="syncToGitHub()">åŒæ­¥åˆ°GitHub</button>
            </div>
            
            <div id="reportContent" style="margin-top: 30px;"></div>
        </div>

        <!-- è¨­å®šå€åŸŸ -->
        <div id="settingsTab" class="content" style="display: none;">
            <h2>ç³»çµ±è¨­å®š</h2>
            <div style="margin-bottom: 20px;">
                <h3>GitHub è¨­å®š</h3>
                <p style="margin-bottom: 10px;">è¨­å®š GitHub å„²å­˜åº«ä¾†ä¿å­˜éŠ·å”®æ•¸æ“š</p>
                <input type="text" id="githubToken" placeholder="GitHub Token" style="width: 100%; padding: 10px; margin-bottom: 10px;">
                <input type="text" id="githubRepo" placeholder="å„²å­˜åº«åç¨± (ä¾‹å¦‚: username/repo)" style="width: 100%; padding: 10px; margin-bottom: 10px;">
                <button class="btn btn-primary" onclick="saveGitHubSettings()">å„²å­˜è¨­å®š</button>
            </div>
            
            <div style="margin-top: 30px;">
                <h3>è³‡æ–™ç®¡ç†</h3>
                <button class="btn btn-secondary" onclick="downloadBackup()">ä¸‹è¼‰å‚™ä»½</button>
                <button class="btn btn-secondary" onclick="clearLocalData()">æ¸…é™¤æœ¬åœ°è³‡æ–™</button>
            </div>
        </div>
    </div>

    <!-- è³¼ç‰©è»Š -->
    <div class="cart" onclick="toggleCart()">
        ğŸ›’ è³¼ç‰©è»Š
        <span class="cart-count" id="cartCount">0</span>
    </div>

    <!-- è³¼ç‰©è»Šè©³æƒ… -->
    <div class="cart-modal" id="cartModal">
        <div class="cart-content">
            <h2>è³¼ç‰©è»Š</h2>
            <div id="cartItems"></div>
            <div style="margin-top: 20px; border-top: 2px solid #ddd; padding-top: 20px;">
                <h3>ç¸½è¨ˆ: <span id="totalAmount">NT$0</span></h3>
                <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="checkout()">çµå¸³</button>
                <button class="btn btn-secondary" style="width: 100%; margin-top: 10px;" onclick="toggleCart()">ç¹¼çºŒé»é¤</button>
            </div>
        </div>
    </div>

    <!-- åŒæ­¥ç‹€æ…‹æç¤º -->
    <div class="sync-status" id="syncStatus"></div>

    <script>
        // èœå–®è³‡æ–™
        const menuData = {
            fried: [
                { id: 'f1', name: 'é¦™è…¸ç¢—ç²¿', price: 50, category: 'ç‚¸ç‰©å€' },
                { id: 'f2', name: 'è˜¿è””ç³•è¾£å—ç“œå£å‘³', price: 35, category: 'ç‚¸ç‰©å€' },
                { id: 'f3', name: 'è˜¿è””ç³•èŠ‹é ­å£å‘³', price: 35, category: 'ç‚¸ç‰©å€' },
                { id: 'f4', name: 'ç‚¸ç‰çƒç²¿åŸå‘³', price: 35, category: 'ç‚¸ç‰©å€' },
                { id: 'f5', name: 'ç‚¸ç‰çƒç²¿åŠ ç‡’è‚‰', price: 70, category: 'ç‚¸ç‰©å€' },
                { id: 'f6', name: 'ç‚¸è”¥æ²¹æ¢', price: 20, category: 'ç‚¸ç‰©å€' },
                { id: 'f7', name: 'ç‚¸é­šæ¢ä¸€ä»½3æ¢', price: 30, category: 'ç‚¸ç‰©å€' },
                { id: 'f8', name: 'ç‚¸èŠ‹ä¸¸ä¸€ä»½3é¡†', price: 35, category: 'ç‚¸ç‰©å€' },
                { id: 'f9', name: 'ç‚¸é›è…¿æ’', price: 35, category: 'ç‚¸ç‰©å€' },
                { id: 'f10', name: 'ç‚¸èŠ±æä¸¸', price: 25, category: 'ç‚¸ç‰©å€' },
                { id: 'f11', name: 'ç‚¸è‚‰åœ“ä¸€é¡†', price: 35, category: 'ç‚¸ç‰©å€' },
                { id: 'f12', name: 'éŠ€çµ²å·+ç…‰ä¹³', price: 40, category: 'ç‚¸ç‰©å€' },
                { id: 'f13', name: 'ç†±ç‹—', price: 35, category: 'ç‚¸ç‰©å€' },
                { id: 'f14', name: 'å°é›å¡Š', price: 35, category: 'ç‚¸ç‰©å€' },
                { id: 'f15', name: 'å°è‚‰è±†', price: 35, category: 'ç‚¸ç‰©å€' },
                { id: 'f16', name: 'ç‚¸é›è…¿', price: 40, category: 'ç‚¸ç‰©å€' },
                { id: 'f17', name: 'å¤§è…¸åŒ…å°è…¸', price: 50, category: 'ç‚¸ç‰©å€' }
            ],
            egg: [
                { id: 'e1', name: 'ç‡’è‚‰è›‹é¤…', price: 45, category: 'è›‹é¤…å€' },
                { id: 'e2', name: 'åŸå‘³è›‹é¤…', price: 25, category: 'è›‹é¤…å€' },
                { id: 'e3', name: 'ç‰ç±³è›‹é¤…', price: 35, category: 'è›‹é¤…å€' },
                { id: 'e4', name: 'è‚‰é¬†è›‹é¤…', price: 35, category: 'è›‹é¤…å€' },
                { id: 'e5', name: 'ç«è…¿è›‹é¤…', price: 35, category: 'è›‹é¤…å€' },
                { id: 'e6', name: 'èµ·å¸è›‹é¤…', price: 35, category: 'è›‹é¤…å€' },
                { id: 'e7', name: 'æ²¹æ¢è›‹é¤…', price: 40, category: 'è›‹é¤…å€' }
            ],
            bun: [
                { id: 'b1', name: 'åŸå‘³é¥…é ­åŒ…', price: 20, category: 'é¥…é ­å€' },
                { id: 'b2', name: 'é»‘ç³–é¥…é ­åŒ…', price: 25, category: 'é¥…é ­å€' },
                { id: 'b3', name: 'çœŸèŠ‹é ­é¥…é ­', price: 15, category: 'é¥…é ­å€' },
                { id: 'b4', name: 'é»‘ç³–è‘¡è„ä¹¾é¥…é ­', price: 15, category: 'é¥…é ­å€' },
                { id: 'b5', name: 'è¿·ä½ å°éŠ€çµ²æ²6é¡†', price: 20, category: 'é¥…é ­å€' },
                { id: 'b6', name: 'å‚³çµ±ç™½é¥…é ­', price: 10, category: 'é¥…é ­å€' },
                { id: 'b7', name: 'è”¥è¾£é¥…é ­', price: 15, category: 'é¥…é ­å€' },
                { id: 'b8', name: 'ç´ èœåŒ…', price: 20, category: 'é¥…é ­å€' },
                { id: 'b9', name: 'è‚‰åŒ…', price: 20, category: 'é¥…é ­å€' }
            ],
            rice: [
                { id: 'r1', name: 'é¦™è…¸é£¯ç³°', price: 30, category: 'é£¯ç³°å€' },
                { id: 'r2', name: 'è›‹åŒ…é£¯ç³°', price: 40, category: 'é£¯ç³°å€' },
                { id: 'r3', name: 'ç‡’è‚‰é£¯ç³°', price: 45, category: 'é£¯ç³°å€' },
                { id: 'r4', name: 'ç¸½åŒ¯é£¯ç³°', price: 50, category: 'é£¯ç³°å€' },
                { id: 'r5', name: 'å£½å¸', price: 60, category: 'é£¯ç³°å€' },
                { id: 'r6', name: 'ç‚’é£¯+è›‹', price: 40, category: 'é£¯ç³°å€' },
                { id: 'r7', name: 'ç‚’é£¯+å‰ç‡’é›è…¿', price: 65, category: 'é£¯ç³°å€' },
                { id: 'r8', name: 'ç‚’é£¯+ç‡’è‚‰', price: 50, category: 'é£¯ç³°å€' },
                { id: 'r9', name: 'éºµç·š+è›‹', price: 40, category: 'é£¯ç³°å€' },
                { id: 'r10', name: 'éºµç·š+å‰ç‡’é›è…¿', price: 65, category: 'é£¯ç³°å€' },
                { id: 'r11', name: 'éºµç·š+ç‡’è‚‰', price: 50, category: 'é£¯ç³°å€' },
                { id: 'r12', name: 'æ¹¯åŒ…å¤§ä»½', price: 60, category: 'é£¯ç³°å€' },
                { id: 'r13', name: 'æ¹¯åŒ…å°ä»½', price: 35, category: 'é£¯ç³°å€' }
            ],
            drink: [
                { id: 'd1', name: 'å’–å•¡ç‰›å¥¶ å°', price: 15, category: 'é£²æ–™å€' },
                { id: 'd2', name: 'å’–å•¡ç‰›å¥¶ ä¸­', price: 20, category: 'é£²æ–™å€' },
                { id: 'd3', name: 'å’–å•¡ç‰›å¥¶ å¤§', price: 25, category: 'é£²æ–™å€' },
                { id: 'd4', name: 'å¥¶èŒ¶ å°', price: 15, category: 'é£²æ–™å€' },
                { id: 'd5', name: 'å¥¶èŒ¶ ä¸­', price: 20, category: 'é£²æ–™å€' },
                { id: 'd6', name: 'å¥¶èŒ¶ å¤§', price: 25, category: 'é£²æ–™å€' },
                { id: 'd7', name: 'è±†æ¼¿ å°', price: 15, category: 'é£²æ–™å€' },
                { id: 'd8', name: 'è±†æ¼¿ ä¸­', price: 20, category: 'é£²æ–™å€' },
                { id: 'd9', name: 'è±†æ¼¿ å¤§', price: 25, category: 'é£²æ–™å€' },
                { id: 'd10', name: 'è–ä»æ¼¿ å°', price: 15, category: 'é£²æ–™å€' },
                { id: 'd11', name: 'è–ä»æ¼¿ ä¸­', price: 20, category: 'é£²æ–™å€' },
                { id: 'd12', name: 'è–ä»æ¼¿ å¤§', price: 25, category: 'é£²æ–™å€' },
                { id: 'd13', name: 'ç´…èŒ¶ å°', price: 15, category: 'é£²æ–™å€' },
                { id: 'd14', name: 'ç´…èŒ¶ ä¸­', price: 20, category: 'é£²æ–™å€' },
                { id: 'd15', name: 'ç´…èŒ¶ å¤§', price: 25, category: 'é£²æ–™å€' },
                { id: 'd16', name: 'é®®å¥¶èŒ¶ å°', price: 25, category: 'é£²æ–™å€' },
                { id: 'd17', name: 'é®®å¥¶èŒ¶ ä¸­', price: 35, category: 'é£²æ–™å€' },
                { id: 'd18', name: 'é®®å¥¶èŒ¶ å¤§', price: 45, category: 'é£²æ–™å€' }
            ],
            special: [
                { id: 's1', name: 'ç‚¸æ‹‰è…¿è…¿è»Š', price: 65, category: 'æ¼¢å ¡åœŸå¸å€' },
                { id: 's2', name: 'ç‡’è‚‰èµ·å¸è›‹åå¸', price: 55, category: 'æ¼¢å ¡åœŸå¸å€' },
                { id: 's3', name: 'ç‡’è‚‰èµ·å¸è›‹æ¼¢å ¡', price: 55, category: 'æ¼¢å ¡åœŸå¸å€' },
                { id: 's4', name: 'ç‡’è‚‰è›‹åå¸', price: 45, category: 'æ¼¢å ¡åœŸå¸å€' },
                { id: 's5', name: 'ç‡’è‚‰è›‹æ¼¢å ¡', price: 45, category: 'æ¼¢å ¡åœŸå¸å€' },
                { id: 's6', name: 'ç‡’è‚‰åˆˆåŒ…', price: 50, category: 'æ¼¢å ¡åœŸå¸å€' },
                { id: 's7', name: 'ç‚¸å•¦é›äºŒæ˜æ²»', price: 30, category: 'æ¼¢å ¡åœŸå¸å€' },
                { id: 's8', name: 'å·§å…‹åŠ›åœŸå¸', price: 15, category: 'æ¼¢å ¡åœŸå¸å€' },
                { id: 's9', name: 'å¥¶é…¥åœŸå¸', price: 20, category: 'æ¼¢å ¡åœŸå¸å€' },
                { id: 's10', name: 'æ³•åœ‹åœŸå¸', price: 30, category: 'æ¼¢å ¡åœŸå¸å€' }
            ]
        };

        // è³¼ç‰©è»Šè³‡æ–™
        let cart = [];
        let orders = [];
        let dailySales = {
            date: new Date().toLocaleDateString(),
            revenue: 0,
            orderCount: 0,
            items: {},
            categories: {},
            customers: {}
        };
        let regularCustomers = [];

        // åˆå§‹åŒ–
        window.onload = function() {
            loadLocalData();
            displayMenu('all');
            updateTime();
            setInterval(updateTime, 1000);
            updateCartDisplay();
            updateStats();
        };

        // æ›´æ–°æ™‚é–“
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleString('zh-TW');
        }

        // é¡¯ç¤ºæ¨™ç±¤é 
        function showTab(tabName) {
            // éš±è—æ‰€æœ‰å…§å®¹
            document.querySelectorAll('.content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // ç§»é™¤æ‰€æœ‰ active é¡åˆ¥
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // é¡¯ç¤ºé¸ä¸­çš„æ¨™ç±¤é 
            document.getElementById(tabName + 'Tab').style.display = 'block';
            event.target.classList.add('active');
            
            if (tabName === 'stats') {
                updateStats();
            }
        }

        // é¡¯ç¤ºé¡åˆ¥
        function showCategory(category) {
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            displayMenu(category);
        }

        // é¡¯ç¤ºèœå–®
        function displayMenu(category) {
            const menuItems = document.getElementById('menuItems');
            menuItems.innerHTML = '';
            
            let items = [];
            if (category === 'all') {
                Object.values(menuData).forEach(categoryItems => {
                    items = items.concat(categoryItems);
                });
            } else {
                items = menuData[category] || [];
            }
            
            items.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'menu-item fade-in';
                itemDiv.innerHTML = `
                    <h3>${item.name}</h3>
                    <div class="price">NT$${item.price}</div>
                    <button class="add-btn" onclick="addToCart('${item.id}', '${item.name}', ${item.price}, '${item.category}')">
                        åŠ å…¥è³¼ç‰©è»Š
                    </button>
                `;
                menuItems.appendChild(itemDiv);
            });
        }

        // åŠ å…¥è³¼ç‰©è»Š
        function addToCart(id, name, price, category) {
            const existingItem = cart.find(item => item.id === id);
            
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({
                    id: id,
                    name: name,
                    price: price,
                    category: category,
                    quantity: 1
                });
            }
            
            updateCartDisplay();
            showNotification('å·²åŠ å…¥è³¼ç‰©è»Šï¼');
        }

        // æ›´æ–°è³¼ç‰©è»Šé¡¯ç¤º
        function updateCartDisplay() {
            const cartCount = document.getElementById('cartCount');
            const totalQuantity = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = totalQuantity;
            
            const cartItems = document.getElementById('cartItems');
            const totalAmount = document.getElementById('totalAmount');
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<p style="text-align: center; color: #999;">è³¼ç‰©è»Šæ˜¯ç©ºçš„</p>';
                totalAmount.textContent = 'NT$0';
                return;
            }
            
            cartItems.innerHTML = '';
            let total = 0;
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                const itemDiv = document.createElement('div');
                itemDiv.className = 'cart-item';
                itemDiv.innerHTML = `
                    <div>
                        <strong>${item.name}</strong>
                        <div style="color: #666; font-size: 14px;">NT$${item.price} Ã— ${item.quantity} = NT$${itemTotal}</div>
                    </div>
                    <div class="quantity-control">
                        <button class="quantity-btn" onclick="updateQuantity('${item.id}', -1)">-</button>
                        <span style="margin: 0 10px;">${item.quantity}</span>
                        <button class="quantity-btn" onclick="updateQuantity('${item.id}', 1)">+</button>
                    </div>
                `;
                cartItems.appendChild(itemDiv);
            });
            
            totalAmount.textContent = `NT$${total}`;
        }

        // æ›´æ–°æ•¸é‡
        function updateQuantity(id, change) {
            const item = cart.find(item => item.id === id);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    cart = cart.filter(i => i.id !== id);
                }
                updateCartDisplay();
            }
        }

        // åˆ‡æ›è³¼ç‰©è»Š
        function toggleCart() {
            const modal = document.getElementById('cartModal');
            modal.style.display = modal.style.display === 'block' ? 'none' : 'block';
        }

        // çµå¸³
        function checkout() {
            if (cart.length === 0) {
                alert('è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼');
                return;
            }
            
            const order = {
                id: 'ORD-' + Date.now(),
                timestamp: new Date().toISOString(),
                items: [...cart],
                total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0)
            };
            
            // å„²å­˜è¨‚å–®
            orders.push(order);
            
            // æ›´æ–°æ¯æ—¥éŠ·å”®æ•¸æ“š
            updateDailySales(order);
            
            // å„²å­˜åˆ°æœ¬åœ°
            saveLocalData();
            
            // æ¸…ç©ºè³¼ç‰©è»Š
            cart = [];
            updateCartDisplay();
            toggleCart();
            
            showNotification('è¨‚å–®å®Œæˆï¼');
            updateStats();
        }

        // æ›´æ–°æ¯æ—¥éŠ·å”®æ•¸æ“š
        function updateDailySales(order) {
            dailySales.revenue += order.total;
            dailySales.orderCount++;
            
            order.items.forEach(item => {
                // æ›´æ–°å•†å“éŠ·å”®æ•¸æ“š
                if (!dailySales.items[item.id]) {
                    dailySales.items[item.id] = {
                        name: item.name,
                        quantity: 0,
                        revenue: 0
                    };
                }
                dailySales.items[item.id].quantity += item.quantity;
                dailySales.items[item.id].revenue += item.price * item.quantity;
                
                // æ›´æ–°é¡åˆ¥éŠ·å”®æ•¸æ“š
                if (!dailySales.categories[item.category]) {
                    dailySales.categories[item.category] = {
                        quantity: 0,
                        revenue: 0
                    };
                }
                dailySales.categories[item.category].quantity += item.quantity;
                dailySales.categories[item.category].revenue += item.price * item.quantity;
            });
        }

        // æ›´æ–°çµ±è¨ˆ
        function updateStats() {
            // ä»Šæ—¥ç‡Ÿæ¥­é¡
            document.getElementById('todayRevenue').textContent = `NT$${dailySales.revenue}`;
            
            // è¨‚å–®æ•¸é‡
            document.getElementById('orderCount').textContent = dailySales.orderCount;
            
            // å¹³å‡è¨‚å–®é‡‘é¡
            const avgOrder = dailySales.orderCount > 0 ? Math.round(dailySales.revenue / dailySales.orderCount) : 0;
            document.getElementById('avgOrder').textContent = `NT$${avgOrder}`;
            
            // ç†±éŠ·å•†å“
            const topItem = Object.entries(dailySales.items)
                .sort((a, b) => b[1].quantity - a[1].quantity)[0];
            document.getElementById('topItem').textContent = topItem ? topItem[1].name : '-';
            
            // é¡åˆ¥çµ±è¨ˆ
            const categoryStats = document.getElementById('categoryStats');
            categoryStats.innerHTML = '';
            
            Object.entries(dailySales.categories).forEach(([category, data]) => {
                const percentage = dailySales.revenue > 0 ? 
                    ((data.revenue / dailySales.revenue) * 100).toFixed(1) : 0;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${category}</td>
                    <td>${data.quantity}</td>
                    <td>NT$${data.revenue}</td>
                    <td>${percentage}%</td>
                `;
                categoryStats.appendChild(row);
            });
            
            // ç†±éŠ·å•†å“æ’è¡Œ
            const topItems = document.getElementById('topItems');
            topItems.innerHTML = '';
            
            Object.entries(dailySales.items)
                .sort((a, b) => b[1].quantity - a[1].quantity)
                .slice(0, 10)
                .forEach(([id, data], index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${data.name}</td>
                        <td>${data.quantity}</td>
                        <td>NT$${data.revenue}</td>
                    `;
                    topItems.appendChild(row);
                });
        }

        // é¡¯ç¤ºé€šçŸ¥
        function showNotification(message) {
            const status = document.getElementById('syncStatus');
            status.textContent = message;
            status.classList.add('show');
            
            setTimeout(() => {
                status.classList.remove('show');
            }, 3000);
        }

        // å„²å­˜åˆ°æœ¬åœ°
        function saveLocalData() {
            localStorage.setItem('orders', JSON.stringify(orders));
            localStorage.setItem('dailySales', JSON.stringify(dailySales));
        }

        // è¼‰å…¥æœ¬åœ°è³‡æ–™
        function loadLocalData() {
            const savedOrders = localStorage.getItem('orders');
            const savedDailySales = localStorage.getItem('dailySales');
            
            if (savedOrders) {
                orders = JSON.parse(savedOrders);
            }
            
            if (savedDailySales) {
                const saved = JSON.parse(savedDailySales);
                // æª¢æŸ¥æ˜¯å¦æ˜¯ä»Šå¤©çš„è³‡æ–™
                if (saved.date === new Date().toLocaleDateString()) {
                    dailySales = saved;
                } else {
                    // å¦‚æœä¸æ˜¯ä»Šå¤©ï¼Œé‡ç½®è³‡æ–™
                    dailySales = {
                        date: new Date().toLocaleDateString(),
                        revenue: 0,
                        orderCount: 0,
                        items: {},
                        categories: {}
                    };
                }
            }
        }

        // ç”Ÿæˆæ—¥å ±è¡¨
        function generateDailyReport() {
            const reportContent = document.getElementById('reportContent');
            reportContent.innerHTML = `
                <h3>æ—¥å ±è¡¨ - ${dailySales.date}</h3>
                <p>ç¸½ç‡Ÿæ¥­é¡: NT$${dailySales.revenue}</p>
                <p>è¨‚å–®æ•¸é‡: ${dailySales.orderCount}</p>
                <p>å¹³å‡è¨‚å–®é‡‘é¡: NT$${dailySales.orderCount > 0 ? Math.round(dailySales.revenue / dailySales.orderCount) : 0}</p>
            `;
        }

        // åŒ¯å‡ºCSV
        function exportToCSV() {
            let csv = 'å•†å“åç¨±,æ•¸é‡,ç‡Ÿæ¥­é¡\n';
            
            Object.entries(dailySales.items).forEach(([id, data]) => {
                csv += `${data.name},${data.quantity},${data.revenue}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `éŠ·å”®å ±è¡¨_${dailySales.date.replace(/\//g, '-')}.csv`;
            link.click();
        }

        // åŒæ­¥åˆ° GitHub
        async function syncToGitHub() {
            const token = localStorage.getItem('githubToken');
            const repo = localStorage.getItem('githubRepo');
            
            if (!token || !repo) {
                alert('è«‹å…ˆåœ¨è¨­å®šä¸­é…ç½® GitHubï¼');
                showTab('settings');
                return;
            }
            
            try {
                const [owner, repoName] = repo.split('/');
                const date = new Date().toISOString().split('T')[0];
                const path = `sales/${date}.json`;
                const content = btoa(JSON.stringify({
                    date: dailySales.date,
                    revenue: dailySales.revenue,
                    orderCount: dailySales.orderCount,
                    items: dailySales.items,
                    categories: dailySales.categories,
                    orders: orders.filter(o => o.timestamp.startsWith(date))
                }, null, 2));
                
                // å…ˆæª¢æŸ¥æª”æ¡ˆæ˜¯å¦å­˜åœ¨
                let sha;
                try {
                    const checkResponse = await fetch(
                        `https://api.github.com/repos/${owner}/${repoName}/contents/${path}`,
                        {
                            headers: {
                                'Authorization': `token ${token}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        }
                    );
                    
                    if (checkResponse.ok) {
                        const existingFile = await checkResponse.json();
                        sha = existingFile.sha;
                    }
                } catch (e) {
                    // æª”æ¡ˆä¸å­˜åœ¨ï¼Œé€™æ˜¯æ­£å¸¸çš„
                }
                
                // ä¸Šå‚³æˆ–æ›´æ–°æª”æ¡ˆ
                const response = await fetch(
                    `https://api.github.com/repos/${owner}/${repoName}/contents/${path}`,
                    {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: `Update sales data for ${date}`,
                            content: content,
                            sha: sha // å¦‚æœæª”æ¡ˆå­˜åœ¨ï¼Œéœ€è¦æä¾› sha
                        })
                    }
                );
                
                if (response.ok) {
                    showNotification('å·²æˆåŠŸåŒæ­¥åˆ° GitHubï¼');
                } else {
                    const error = await response.json();
                    throw new Error(error.message || 'åŒæ­¥å¤±æ•—');
                }
            } catch (error) {
                alert('åŒæ­¥å¤±æ•—: ' + error.message);
            }
        }

        // å„²å­˜ GitHub è¨­å®š
        function saveGitHubSettings() {
            const token = document.getElementById('githubToken').value;
            const repo = document.getElementById('githubRepo').value;
            
            if (!token || !repo) {
                alert('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½ï¼');
                return;
            }
            
            localStorage.setItem('githubToken', token);
            localStorage.setItem('githubRepo', repo);
            
            showNotification('GitHub è¨­å®šå·²å„²å­˜ï¼');
        }

        // ä¸‹è¼‰å‚™ä»½
        function downloadBackup() {
            const backup = {
                orders: orders,
                dailySales: dailySales,
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `æ—©é¤åº—å‚™ä»½_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        // æ¸…é™¤æœ¬åœ°è³‡æ–™
        function clearLocalData() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æœ¬åœ°è³‡æ–™å—ï¼Ÿé€™å€‹æ“ä½œç„¡æ³•å¾©åŸï¼')) {
                localStorage.clear();
                orders = [];
                dailySales = {
                    date: new Date().toLocaleDateString(),
                    revenue: 0,
                    orderCount: 0,
                    items: {},
                    categories: {}
                };
                updateStats();
                showNotification('å·²æ¸…é™¤æ‰€æœ‰æœ¬åœ°è³‡æ–™');
            }
        }

        // é—œé–‰è³¼ç‰©è»Šç•¶é»æ“Šå¤–éƒ¨
        window.onclick = function(event) {
            const modal = document.getElementById('cartModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>
</html>
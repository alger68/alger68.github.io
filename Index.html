<script>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªä¸»å­¸ç¿’å·¥å…·é›† - å¢å¼·ç‰ˆéŒ¯é¡Œæœ¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            text-align: center;
            padding: 20px;
        }
        
        .tool-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1px;
            background: #f0f0f0;
        }
        
        .tool-card {
            background: white;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .tool-card:hover {
            background: #f8f9ff;
            transform: scale(1.02);
        }
        
        .tool-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .tool-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .tool-desc {
            font-size: 0.8em;
            color: #666;
        }
        
        .learning-area {
            display: none;
            padding: 20px;
            background: white;
        }
        
        .back-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .btn {
            background: #4ecdc4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin: 10px 0;
            transition: background-color 0.3s ease;
        }
        
        .btn:hover {
            background: #45b7aa;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .result-area {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            min-height: 100px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ecdc4, #44a08d);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .timer {
            font-size: 1.5em;
            text-align: center;
            color: #667eea;
            font-weight: bold;
            margin: 15px 0;
        }
        
        .score {
            text-align: center;
            font-size: 1.2em;
            color: #4ecdc4;
            font-weight: bold;
        }
        
        /* éŒ¯é¡Œæœ¬å°ˆç”¨æ¨£å¼ */
        .error-item {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            background: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .error-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .subject-tag {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            color: white;
        }
        
        .subject-math { background: #ff6b6b; }
        .subject-english { background: #4ecdc4; }
        .subject-physics { background: #667eea; }
        .subject-chemistry { background: #feca57; }
        .subject-other { background: #6c757d; }
        
        .error-stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
            text-align: center;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #666;
        }
        
        .review-schedule {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        
        .review-item {
            flex: 1;
            text-align: center;
            padding: 8px;
            border-radius: 5px;
            font-size: 0.85em;
        }
        
        .review-pending { background: #fff3cd; color: #856404; }
        .review-completed { background: #d4edda; color: #155724; }
        .review-overdue { background: #f8d7da; color: #721c24; }
        
        .difficulty-stars {
            color: #ffd700;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .tabs {
            display: flex;
            gap: 5px;
            margin: 15px 0;
            border-bottom: 2px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 10px 10px 0 0;
            background: #f8f9fa;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: #667eea;
            color: white;
        }
        
        .filter-controls {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 5px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            font-size: 0.9em;
        }
        
        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š è‡ªä¸»å­¸ç¿’å·¥å…·é›†</h1>
            <p>è®“å­¸ç¿’è®Šå¾—æ›´æœ‰è¶£ï¼</p>
        </div>

        <!-- ä¸»é¸å–® -->
        <div id="mainMenu" class="tool-grid">
            <div class="tool-card" onclick="showTool('vocabulary')">
                <div class="tool-icon">ğŸ“</div>
                <div class="tool-name">å–®å­—è¨˜æ†¶</div>
                <div class="tool-desc">èƒŒèª¦å–®å­—</div>
            </div>
            
            <div class="tool-card" onclick="showTool('math')">
                <div class="tool-icon">ğŸ”¢</div>
                <div class="tool-name">æ•¸å­¸ç·´ç¿’</div>
                <div class="tool-desc">è¨ˆç®—è¨“ç·´</div>
            </div>
            
            <div class="tool-card" onclick="showTool('timer')">
                <div class="tool-icon">â°</div>
                <div class="tool-name">å°ˆæ³¨è¨ˆæ™‚</div>
                <div class="tool-desc">ç•ªèŒ„é˜æ³•</div>
            </div>
            
            <div class="tool-card" onclick="showTool('notes')">
                <div class="tool-icon">ğŸ“‹</div>
                <div class="tool-name">ç­†è¨˜æœ¬</div>
                <div class="tool-desc">è¨˜éŒ„é‡é»</div>
            </div>
            
            <div class="tool-card" onclick="showTool('quiz')">
                <div class="tool-icon">ğŸ¯</div>
                <div class="tool-name">éš¨æ©Ÿå•ç­”</div>
                <div class="tool-desc">è‡ªæˆ‘æ¸¬é©—</div>
            </div>
            
            <div class="tool-card" onclick="showTool('irregular')">
                <div class="tool-icon">ğŸ“–</div>
                <div class="tool-name">ä¸è¦å‰‡å‹•è©</div>
                <div class="tool-desc">ä¸‰æ…‹ç·´ç¿’</div>
            </div>
            
            <div class="tool-card" onclick="showTool('errors')">
                <div class="tool-icon">âŒ</div>
                <div class="tool-name">éŒ¯é¡Œæœ¬</div>
                <div class="tool-desc">å¼±é»åˆ†æ</div>
            </div>
            
            <div class="tool-card" onclick="showTool('goals')">
                <div class="tool-icon">ğŸ¯</div>
                <div class="tool-name">å­¸ç¿’ç›®æ¨™</div>
                <div class="tool-desc">é€²åº¦è¿½è¹¤</div>
            </div>
        </div>
        
        <!-- å–®å­—è¨˜æ†¶å·¥å…· -->
        <div id="vocabulary" class="learning-area">
            <button class="back-btn" onclick="showMain()">â† è¿”å›ä¸»é¸å–®</button>
            <h2>ğŸ“ å–®å­—è¨˜æ†¶</h2>
            
            <!-- 108èª²ç¶±å–®å­—åº«é¸æ“‡ -->
            <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <h3>ğŸ“š 108èª²ç¶±å®˜æ–¹å–®å­—åº«</h3>
                <div class="input-group">
                    <label>é¸æ“‡ä¸»é¡Œï¼š</label>
                    <select id="curriculumTheme" onchange="updateThemeInfo()">
                        <option value="">-- é¸æ“‡ä¸»é¡Œ --</option>
                        <option value="family">å®¶åº­èˆ‡äººéš›é—œä¿‚</option>
                        <option value="school">å­¸æ ¡ç”Ÿæ´»</option>
                        <option value="daily">æ—¥å¸¸æ´»å‹•</option>
                        <option value="food">é£Ÿç‰©èˆ‡é£²é£Ÿ</option>
                        <option value="body">èº«é«”èˆ‡å¥åº·</option>
                        <option value="clothes">è¡£è‘—èˆ‡è³¼ç‰©</option>
                        <option value="home">ä½å®¶èˆ‡ç’°å¢ƒ</option>
                        <option value="time">æ™‚é–“èˆ‡æ—¥æœŸ</option>
                        <option value="numbers">æ•¸å­—èˆ‡è¨ˆç®—</option>
                        <option value="transport">äº¤é€šèˆ‡æ—…éŠ</option>
                        <option value="sports">é‹å‹•èˆ‡ä¼‘é–’</option>
                        <option value="jobs">è·æ¥­èˆ‡å·¥ä½œ</option>
                        <option value="weather">å¤©æ°£èˆ‡å­£ç¯€</option>
                        <option value="animals">å‹•ç‰©èˆ‡è‡ªç„¶</option>
                        <option value="tech">ç§‘æŠ€èˆ‡åª’é«”</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>é¸æ“‡å¹´ç´šï¼š</label>
                    <select id="gradeLevel">
                        <option value="all">å…¨éƒ¨</option>
                        <option value="7">ä¸ƒå¹´ç´š</option>
                        <option value="8">å…«å¹´ç´š</option>
                        <option value="9">ä¹å¹´ç´š</option>
                    </select>
                </div>
                
                <div id="themeInfo" style="margin-top: 10px; padding: 10px; background: white; border-radius: 5px; display: none;">
                    <p id="themeDescription"></p>
                    <p>å–®å­—æ•¸é‡ï¼š<span id="themeWordCount">0</span> å€‹</p>
                </div>
                
                <button class="btn" onclick="loadCurriculumWords()" style="background: #1976d2;">è¼‰å…¥å®˜æ–¹å–®å­—</button>
                <button class="btn btn-success" onclick="showLearningPath()">æ™ºæ…§å­¸ç¿’è·¯å¾‘</button>
            </div>
            
            <!-- å­¸ç¿’é€²åº¦è¦–è¦ºåŒ– -->
            <div id="learningProgress" style="display: none; margin: 15px 0;">
                <h4>ğŸ“Š å­¸ç¿’é€²åº¦</h4>
                <div class="progress-bar" style="height: 30px; position: relative;">
                    <div class="progress-fill" id="vocabularyProgress" style="width: 0%"></div>
                    <span style="position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); color: #333; font-weight: bold;">
                        <span id="learnedWords">0</span> / <span id="totalWords">0</span>
                    </span>
                </div>
                <div style="margin-top: 10px; display: flex; justify-content: space-between; font-size: 0.9em;">
                    <span>ğŸ†• æ–°å­¸ï¼š<span id="newWordsCount">0</span></span>
                    <span>ğŸ“ è¤‡ç¿’ä¸­ï¼š<span id="reviewingCount">0</span></span>
                    <span>âœ… å·²æŒæ¡ï¼š<span id="masteredCount">0</span></span>
                </div>
            </div>
            
            <!-- å–®å­—è¼¸å…¥å€ -->
            <div class="input-group">
                <label>æ–°å¢å–®å­—ï¼š</label>
                <input type="text" id="newWord" placeholder="è¼¸å…¥è‹±æ–‡å–®å­—">
            </div>
            
            <div class="input-group">
                <label>ä¸­æ–‡æ„æ€ï¼š</label>
                <input type="text" id="wordMeaning" placeholder="è¼¸å…¥ä¸­æ–‡æ„æ€">
            </div>
            
            <div class="input-group">
                <label>ä¾‹å¥ï¼ˆé¸å¡«ï¼‰ï¼š</label>
                <input type="text" id="wordExample" placeholder="è¼¸å…¥ä¾‹å¥">
            </div>
            
            <button class="btn" onclick="addWord()">æ–°å¢å–®å­—</button>
            
            <!-- æ‰¹é‡åŒ¯å…¥å€ -->
            <div style="margin: 20px 0; padding: 15px; border: 2px dashed #ddd; border-radius: 10px;">
                <h3>ğŸ“¥ æ‰¹é‡åŒ¯å…¥å–®å­—</h3>
                <div class="input-group">
                    <label>åŒ¯å…¥æ ¼å¼ï¼šè‹±æ–‡å–®å­—,ä¸­æ–‡æ„æ€[,ä¾‹å¥]ï¼ˆæ¯è¡Œä¸€çµ„ï¼‰</label>
                    <textarea id="importWords" rows="4" placeholder="ä¾‹å¦‚ï¼š&#10;apple,è˜‹æœ&#10;book,æ›¸æœ¬,I love reading books.&#10;computer,é›»è…¦,I use a computer every day."></textarea>
                </div>
                <button class="btn" onclick="importWords()">åŒ¯å…¥å–®å­—</button>
                
                <div class="input-group" style="margin-top: 15px;">
                    <label>æˆ–ä¸Šå‚³CSVæª”æ¡ˆï¼š</label>
                    <input type="file" id="csvFile" accept=".csv,.txt" onchange="handleFileUpload(event)">
                </div>
            </div>
            
            <!-- å­¸ç¿’æ¨¡å¼é¸æ“‡ -->
            <div style="background: #f5f5f5; padding: 15px; border-radius: 10px; margin: 15px 0;">
                <h4>ğŸ¯ å­¸ç¿’æ¨¡å¼</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <button class="btn" onclick="startWordTest()">ğŸ“ å–®å­—æ¸¬é©—</button>
                    <button class="btn" onclick="startExamplePractice()">ğŸ’¬ ä¾‹å¥ç·´ç¿’</button>
                    <button class="btn" onclick="startSpellingTest()">âœï¸ æ‹¼å­—æ¸¬é©—</button>
                    <button class="btn" onclick="reviewWords()">ğŸ”„ æ™ºæ…§è¤‡ç¿’</button>
                </div>
            </div>
            
            <button class="btn" onclick="showAllWords()" style="background: #28a745;">é¡¯ç¤ºæ‰€æœ‰å–®å­—</button>
            <button class="btn" onclick="exportWords()" style="background: #6c757d;">åŒ¯å‡ºå–®å­—</button>
            
            <div class="result-area" id="wordResult">
                <p>ç›®å‰å–®å­—åº«ï¼š<span id="wordCount">0</span> å€‹å–®å­—</p>
                <div id="wordDisplay"></div>
            </div>
        </div>
        
        <!-- æ•¸å­¸ç·´ç¿’å·¥å…· -->
        <div id="math" class="learning-area">
            <button class="back-btn" onclick="showMain()">â† è¿”å›ä¸»é¸å–®</button>
            <h2>ğŸ”¢ æ•¸å­¸ç·´ç¿’</h2>
            
            <div class="input-group">
                <label>é¸æ“‡é›£åº¦ï¼š</label>
                <select id="mathLevel">
                    <option value="easy">ç°¡å–® (1-10)</option>
                    <option value="medium">ä¸­ç­‰ (1-50)</option>
                    <option value="hard">å›°é›£ (1-100)</option>
                </select>
            </div>
            
            <div class="input-group">
                <label>é‹ç®—é¡å‹ï¼š</label>
                <select id="mathType">
                    <option value="add">åŠ æ³•</option>
                    <option value="sub">æ¸›æ³•</option>
                    <option value="mul">ä¹˜æ³•</option>
                    <option value="mix">æ··åˆ</option>
                </select>
            </div>
            
            <button class="btn" onclick="startMathPractice()">é–‹å§‹ç·´ç¿’</button>
            
            <div class="result-area" id="mathResult">
                <div class="score">ç­”å°ï¼š<span id="correctCount">0</span> / <span id="totalCount">0</span></div>
                <div id="mathQuestion"></div>
                <input type="number" id="mathAnswer" placeholder="è¼¸å…¥ç­”æ¡ˆ" style="display:none;">
                <button class="btn" id="submitMath" onclick="checkMathAnswer()" style="display:none;">æäº¤ç­”æ¡ˆ</button>
            </div>
        </div>
        
        <!-- å°ˆæ³¨è¨ˆæ™‚å·¥å…· -->
        <div id="timer" class="learning-area">
            <button class="back-btn" onclick="showMain()">â† è¿”å›ä¸»é¸å–®</button>
            <h2>â° å°ˆæ³¨è¨ˆæ™‚</h2>
            
            <div class="input-group">
                <label>è¨­å®šæ™‚é–“ï¼ˆåˆ†é˜ï¼‰ï¼š</label>
                <select id="timerMinutes">
                    <option value="5">5åˆ†é˜</option>
                    <option value="15">15åˆ†é˜</option>
                    <option value="25" selected>25åˆ†é˜ï¼ˆç•ªèŒ„é˜ï¼‰</option>
                    <option value="30">30åˆ†é˜</option>
                    <option value="60">60åˆ†é˜</option>
                </select>
            </div>
            
            <button class="btn" onclick="startTimer()">é–‹å§‹è¨ˆæ™‚</button>
            <button class="btn" onclick="pauseTimer()">æš«åœ/ç¹¼çºŒ</button>
            <button class="btn" onclick="resetTimer()">é‡è¨­</button>
            
            <div class="result-area">
                <div class="timer" id="timerDisplay">25:00</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="timerProgress"></div>
                </div>
                <div id="timerStatus">æº–å‚™é–‹å§‹å°ˆæ³¨å­¸ç¿’ï¼</div>
            </div>
        </div>
        
        <!-- ç­†è¨˜æœ¬å·¥å…· -->
        <div id="notes" class="learning-area">
            <button class="back-btn" onclick="showMain()">â† è¿”å›ä¸»é¸å–®</button>
            <h2>ğŸ“‹ ç­†è¨˜æœ¬</h2>
            
            <div class="input-group">
                <label>ç­†è¨˜æ¨™é¡Œï¼š</label>
                <input type="text" id="noteTitle" placeholder="è¼¸å…¥ç­†è¨˜æ¨™é¡Œ">
            </div>
            
            <div class="input-group">
                <label>ç­†è¨˜å…§å®¹ï¼š</label>
                <textarea id="noteContent" rows="6" placeholder="è¼¸å…¥ç­†è¨˜å…§å®¹..."></textarea>
            </div>
            
            <button class="btn" onclick="saveNote()">å„²å­˜ç­†è¨˜</button>
            <button class="btn" onclick="showNotes()">é¡¯ç¤ºæ‰€æœ‰ç­†è¨˜</button>
            <button class="btn" onclick="exportNotes()" style="background: #6c757d;">åŒ¯å‡ºç­†è¨˜</button>
            
            <div class="result-area" id="notesResult">
                <p>ç­†è¨˜æœƒè‡ªå‹•å„²å­˜åœ¨ç€è¦½å™¨ä¸­</p>
            </div>
        </div>
        
        <!-- éš¨æ©Ÿå•ç­”å·¥å…· -->
        <div id="quiz" class="learning-area">
            <button class="back-btn" onclick="showMain()">â† è¿”å›ä¸»é¸å–®</button>
            <h2>ğŸ¯ éš¨æ©Ÿå•ç­”</h2>
            
            <div class="input-group">
                <label>æ–°å¢å•é¡Œï¼š</label>
                <input type="text" id="newQuestion" placeholder="è¼¸å…¥å•é¡Œ">
            </div>
            
            <div class="input-group">
                <label>ç­”æ¡ˆï¼š</label>
                <input type="text" id="questionAnswer" placeholder="è¼¸å…¥ç­”æ¡ˆ">
            </div>
            
            <button class="btn" onclick="addQuestion()">æ–°å¢å•é¡Œ</button>
            <button class="btn" onclick="startQuiz()">é–‹å§‹å•ç­”</button>
            <button class="btn" onclick="showAllQuestions()" style="background: #28a745;">é¡¯ç¤ºæ‰€æœ‰å•é¡Œ</button>
            <button class="btn" onclick="exportQuestions()" style="background: #6c757d;">åŒ¯å‡ºé¡Œåº«</button>
            
            <div class="result-area" id="quizResult">
                <p>é¡Œåº«ï¼š<span id="questionCount">0</span> é¡Œ</p>
                <div id="quizDisplay"></div>
            </div>
        </div>
        
        <!-- éŒ¯é¡Œæœ¬å·¥å…·ï¼ˆå¢å¼·ç‰ˆï¼‰ -->
        <div id="errors" class="learning-area">
            <button class="back-btn" onclick="showMain()">â† è¿”å›ä¸»é¸å–®</button>
            <h2>âŒ éŒ¯é¡Œæœ¬</h2>
            
            <!-- çµ±è¨ˆå€åŸŸ -->
            <div class="error-stats">
                <div class="stat-card">
                    <div class="stat-number" id="errorTotal">0</div>
                    <div class="stat-label">ç¸½éŒ¯é¡Œæ•¸</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="errorReviewed">0</div>
                    <div class="stat-label">å·²è¤‡ç¿’</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="errorMastered">0</div>
                    <div class="stat-label">å·²æŒæ¡</div>
                </div>
            </div>
            
            <!-- æ¨™ç±¤é  -->
            <div class="tabs">
                <div class="tab active" onclick="switchErrorTab('add')">æ–°å¢éŒ¯é¡Œ</div>
                <div class="tab" onclick="switchErrorTab('review')">è¤‡ç¿’éŒ¯é¡Œ</div>
                <div class="tab" onclick="switchErrorTab('list')">éŒ¯é¡Œåˆ—è¡¨</div>
                <div class="tab" onclick="switchErrorTab('analysis')">å¼±é»åˆ†æ</div>
            </div>
            
            <!-- æ–°å¢éŒ¯é¡Œé é¢ -->
            <div id="errorAddTab" class="error-tab-content">
                <div class="input-group">
                    <label>ç§‘ç›®ï¼š</label>
                    <select id="errorSubject">
                        <option value="math">æ•¸å­¸</option>
                        <option value="english">è‹±èª</option>
                        <option value="physics">ç‰©ç†</option>
                        <option value="chemistry">åŒ–å­¸</option>
                        <option value="other">å…¶ä»–</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>ç« ç¯€/å–®å…ƒï¼š</label>
                    <input type="text" id="errorChapter" placeholder="ä¾‹å¦‚ï¼šäºŒæ¬¡æ–¹ç¨‹å¼">
                </div>
                
                <div class="input-group">
                    <label>é¡Œç›®ï¼š</label>
                    <textarea id="errorQuestion" rows="3" placeholder="è¼¸å…¥é¡Œç›®å…§å®¹"></textarea>
                </div>
                
                <div class="input-group">
                    <label>æˆ‘çš„ç­”æ¡ˆï¼ˆéŒ¯èª¤ï¼‰ï¼š</label>
                    <input type="text" id="errorMyAnswer" placeholder="è¼¸å…¥éŒ¯èª¤ç­”æ¡ˆ">
                </div>
                
                <div class="input-group">
                    <label>æ­£ç¢ºç­”æ¡ˆï¼š</label>
                    <input type="text" id="errorCorrectAnswer" placeholder="è¼¸å…¥æ­£ç¢ºç­”æ¡ˆ">
                </div>
                
                <div class="input-group">
                    <label>è§£é¡Œæ­¥é©Ÿï¼š</label>
                    <textarea id="errorSolution" rows="3" placeholder="è©³ç´°è§£é¡Œéç¨‹"></textarea>
                </div>
                
                <div class="input-group">
                    <label>éŒ¯èª¤åŸå› ï¼š</label>
                    <textarea id="errorReason" rows="2" placeholder="åˆ†æéŒ¯èª¤åŸå› "></textarea>
                </div>
                
                <div class="input-group">
                    <label>é›£åº¦ï¼š</label>
                    <select id="errorDifficulty">
                        <option value="1">â­ ç°¡å–®</option>
                        <option value="2">â­â­ ä¸­ç­‰</option>
                        <option value="3">â­â­â­ å›°é›£</option>
                    </select>
                </div>
                
                <button class="btn" onclick="addError()">å„²å­˜éŒ¯é¡Œ</button>
                <button class="btn btn-secondary" onclick="clearErrorForm()">æ¸…é™¤è¡¨å–®</button>
                <button class="btn" onclick="importFromQuestions()" style="background: #17a2b8;">å¾é¡Œåº«åŒ¯å…¥</button>
            </div>
            
            <!-- è¤‡ç¿’éŒ¯é¡Œé é¢ -->
            <div id="errorReviewTab" class="error-tab-content" style="display: none;">
                <div class="filter-controls">
                    <button class="filter-btn active" onclick="filterReview('all')">å…¨éƒ¨</button>
                    <button class="filter-btn" onclick="filterReview('today')">ä»Šæ—¥è¤‡ç¿’</button>
                    <button class="filter-btn" onclick="filterReview('overdue')">é€¾æœŸæœªè¤‡ç¿’</button>
                    <button class="filter-btn" onclick="filterReview('subject')">æŒ‰ç§‘ç›®</button>
                </div>
                
                <div id="reviewContent">
                    <p style="text-align: center; color: #666; margin: 20px 0;">é¸æ“‡ç¯©é¸æ¢ä»¶é–‹å§‹è¤‡ç¿’</p>
                </div>
            </div>
            
            <!-- éŒ¯é¡Œåˆ—è¡¨é é¢ -->
            <div id="errorListTab" class="error-tab-content" style="display: none;">
                <div class="filter-controls">
                    <button class="filter-btn active" onclick="filterErrors('all')">å…¨éƒ¨</button>
                    <button class="filter-btn" onclick="filterErrors('math')">æ•¸å­¸</button>
                    <button class="filter-btn" onclick="filterErrors('english')">è‹±èª</button>
                    <button class="filter-btn" onclick="filterErrors('physics')">ç‰©ç†</button>
                    <button class="filter-btn" onclick="filterErrors('chemistry')">åŒ–å­¸</button>
                    <button class="filter-btn" onclick="filterErrors('other')">å…¶ä»–</button>
                </div>
                
                <button class="btn btn-success" onclick="exportErrors()">åŒ¯å‡ºéŒ¯é¡Œ</button>
                <button class="btn btn-danger" onclick="clearAllErrors()">æ¸…ç©ºæ‰€æœ‰</button>
                
                <div id="errorListContent">
                    <!-- éŒ¯é¡Œåˆ—è¡¨æœƒå‹•æ…‹ç”Ÿæˆåœ¨é€™è£¡ -->
                </div>
            </div>
            
            <!-- å¼±é»åˆ†æé é¢ -->
            <div id="errorAnalysisTab" class="error-tab-content" style="display: none;">
                <div id="analysisContent">
                    <!-- åˆ†æå…§å®¹æœƒå‹•æ…‹ç”Ÿæˆåœ¨é€™è£¡ -->
                </div>
            </div>
        </div>
        
        <!-- å­¸ç¿’ç›®æ¨™å·¥å…· -->
        <div id="goals" class="learning-area">
            <button class="back-btn" onclick="showMain()">â† è¿”å›ä¸»é¸å–®</button>
            <h2>ğŸ¯ å­¸ç¿’ç›®æ¨™</h2>
            
            <div class="input-group">
                <label>æ–°å¢ç›®æ¨™ï¼š</label>
                <input type="text" id="newGoal" placeholder="è¼¸å…¥å­¸ç¿’ç›®æ¨™">
            </div>
            
            <button class="btn" onclick="addGoal()">æ–°å¢ç›®æ¨™</button>
            <button class="btn" onclick="showGoals()">é¡¯ç¤ºç›®æ¨™åˆ—è¡¨</button>
            
            <div class="result-area" id="goalsResult">
                <p>è¨­å®šç›®æ¨™ï¼Œè¿½è¹¤å­¸ç¿’é€²åº¦ï¼</p>
            </div>
        </div>
        
        <!-- ä¸è¦å‰‡å‹•è©å·¥å…· -->
        <div id="irregular" class="learning-area">
            <button class="back-btn" onclick="showMain()">â† è¿”å›ä¸»é¸å–®</button>
            <h2>ğŸ“– ä¸è¦å‰‡å‹•è©ä¸‰æ…‹ç·´ç¿’</h2>
            
            <!-- è¨­å®šå€ -->
            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                <div class="input-group">
                    <label>é¸æ“‡é›£åº¦ï¼š</label>
                    <select id="irregularLevel">
                        <option value="basic">åŸºç¤11å€‹ï¼ˆæœ€é‡è¦ï¼‰</option>
                        <option value="intermediate">é€²éš39å€‹</option>
                        <option value="all">å…¨éƒ¨50å€‹</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>ç·´ç¿’æ¨¡å¼ï¼š</label>
                    <select id="practiceMode">
                        <option value="past">åŸå½¢â†’éå»å¼</option>
                        <option value="pp">åŸå½¢â†’éå»åˆ†è©</option>
                        <option value="base">éå»å¼â†’åŸå½¢</option>
                        <option value="mixed">æ··åˆç·´ç¿’</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>éŸ³æ•ˆè¨­å®šï¼š</label>
                    <label style="display: flex; align-items: center; margin-top: 5px;">
                        <input type="checkbox" id="soundEnabled" checked style="margin-right: 8px;">
                        é–‹å•ŸéŸ³æ•ˆå›é¥‹
                    </label>
                </div>
            </div>
            
            <button class="btn" onclick="startIrregularTest()">é–‹å§‹ç·´ç¿’</button>
            <button class="btn" onclick="showVerbList()" style="background: #28a745;">å‹•è©æ¸…å–®</button>
            
            <div class="result-area" id="irregularResult">
                <div class="score">
                    ç­”å°ï¼š<span id="irregularCorrect">0</span> / <span id="irregularTotal">0</span>
                    <span style="margin-left: 15px;">æ­£ç¢ºç‡ï¼š<span id="irregularRate">0%</span></span>
                </div>
                <div id="irregularDisplay">
                    <p>ğŸ¯ æ ¹æ“šæ•™è‚²éƒ¨ç ”ç©¶ï¼Œé€™50å€‹ä¸è¦å‰‡å‹•è©æ˜¯åœ‹ä¸­æœ€é‡è¦çš„ï¼</p>
                    <p>ğŸ’¡ å»ºè­°å¾ã€ŒåŸºç¤11å€‹ã€é–‹å§‹ï¼Œå®ƒå€‘å è‹±æ–‡ä½¿ç”¨é‡çš„50%ï¼</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let vocabulary = JSON.parse(localStorage.getItem('vocabulary') || '[]');
        let questions = JSON.parse(localStorage.getItem('questions') || '[]');
        let goals = JSON.parse(localStorage.getItem('goals') || '[]');
        let notes = JSON.parse(localStorage.getItem('notes') || '[]');
        let errors = JSON.parse(localStorage.getItem('errors') || '[]'); // éŒ¯é¡Œæ•¸æ“š
        let timerInterval;
        let timerSeconds = 0;
        let timerRunning = false;
        let mathScore = {correct: 0, total: 0};
        let currentMathQuestion = {};
        let currentWordTest = {};
        let currentQuiz = {};
        let irregularScore = {correct: 0, total: 0};
        let currentIrregularTest = {};
        
        // 108èª²ç¶±å–®å­—åº«
        const curriculum108 = {
            family: {
                name: "å®¶åº­èˆ‡äººéš›é—œä¿‚",
                description: "åŒ…å«å®¶åº­æˆå“¡ã€è¦ªå±¬é—œä¿‚ã€æœ‹å‹ç­‰ç›¸é—œè©å½™",
                words: [
                    {word: "family", meaning: "å®¶åº­", example: "My family eats dinner together every night.", grade: 7},
                    {word: "father", meaning: "çˆ¶è¦ª", example: "My father drives me to school every morning.", grade: 7},
                    {word: "mother", meaning: "æ¯è¦ª", example: "My mother helps me with my homework.", grade: 7},
                    {word: "brother", meaning: "å…„å¼Ÿ", example: "My brother plays basketball with his friends.", grade: 7},
                    {word: "sister", meaning: "å§Šå¦¹", example: "My sister and I share the same room.", grade: 7},
                    {word: "son", meaning: "å…’å­", example: "Their son is very smart.", grade: 7},
                    {word: "daughter", meaning: "å¥³å…’", example: "My daughter loves to read books.", grade: 7},
                    {word: "grandfather", meaning: "ç¥–çˆ¶", example: "My grandfather tells interesting stories.", grade: 7},
                    {word: "grandmother", meaning: "ç¥–æ¯", example: "My grandmother makes delicious cookies.", grade: 7},
                    {word: "uncle", meaning: "å”å”/èˆ…èˆ…", example: "My uncle lives in America.", grade: 7},
                    {word: "aunt", meaning: "é˜¿å§¨/å§‘å§‘", example: "My aunt is a teacher.", grade: 7},
                    {word: "cousin", meaning: "è¡¨/å ‚å…„å¼Ÿå§Šå¦¹", example: "I play with my cousins on weekends.", grade: 7},
                    {word: "friend", meaning: "æœ‹å‹", example: "I talk to my best friend every day.", grade: 7},
                    {word: "parents", meaning: "çˆ¶æ¯", example: "My parents are very kind.", grade: 7},
                    {word: "husband", meaning: "ä¸ˆå¤«", example: "Her husband is a doctor.", grade: 8},
                    {word: "wife", meaning: "å¦»å­", example: "His wife works at a bank.", grade: 8}
                ]
            },
            school: {
                name: "å­¸æ ¡ç”Ÿæ´»",
                description: "å­¸æ ¡ç’°å¢ƒã€ç§‘ç›®ã€å­¸ç¿’æ´»å‹•ç›¸é—œè©å½™",
                words: [
                    {word: "school", meaning: "å­¸æ ¡", example: "I go to school every day.", grade: 7},
                    {word: "teacher", meaning: "è€å¸«", example: "Our teacher is very nice.", grade: 7},
                    {word: "student", meaning: "å­¸ç”Ÿ", example: "There are forty students in my class.", grade: 7},
                    {word: "class", meaning: "ç­ç´šï¼›èª²ç¨‹", example: "My favorite class is English.", grade: 7},
                    {word: "classroom", meaning: "æ•™å®¤", example: "We study in the classroom.", grade: 7},
                    {word: "homework", meaning: "å®¶åº­ä½œæ¥­", example: "I do my homework after dinner.", grade: 7},
                    {word: "book", meaning: "æ›¸", example: "I have many books at home.", grade: 7},
                    {word: "pen", meaning: "ç­†", example: "I write with a blue pen.", grade: 7},
                    {word: "pencil", meaning: "é‰›ç­†", example: "I use a pencil for math.", grade: 7},
                    {word: "paper", meaning: "ç´™", example: "Please take out a piece of paper.", grade: 7},
                    {word: "desk", meaning: "æ›¸æ¡Œ", example: "My desk is next to the window.", grade: 7},
                    {word: "test", meaning: "æ¸¬é©—", example: "We have a test tomorrow.", grade: 7},
                    {word: "exam", meaning: "è€ƒè©¦", example: "The final exam is next week.", grade: 8},
                    {word: "library", meaning: "åœ–æ›¸é¤¨", example: "I study in the library after school.", grade: 7},
                    {word: "computer", meaning: "é›»è…¦", example: "We use computers in our IT class.", grade: 7}
                ]
            },
            daily: {
                name: "æ—¥å¸¸æ´»å‹•",
                description: "æ—¥å¸¸ç”Ÿæ´»å‹•ä½œã€ç¿’æ…£ç›¸é—œè©å½™",
                words: [
                    {word: "wake up", meaning: "é†’ä¾†", example: "I wake up at seven o'clock every morning.", grade: 7},
                    {word: "get up", meaning: "èµ·åºŠ", example: "I get up early on weekdays.", grade: 7},
                    {word: "eat", meaning: "åƒ", example: "We eat breakfast at home together.", grade: 7},
                    {word: "drink", meaning: "å–", example: "I drink milk every morning.", grade: 7},
                    {word: "sleep", meaning: "ç¡è¦º", example: "I sleep for eight hours every night.", grade: 7},
                    {word: "study", meaning: "å­¸ç¿’", example: "I study English after school.", grade: 7},
                    {word: "play", meaning: "ç©ï¼›é‹å‹•", example: "We play basketball in the gym after school.", grade: 7},
                    {word: "watch", meaning: "è§€çœ‹", example: "I watch TV after dinner.", grade: 7},
                    {word: "listen", meaning: "è½", example: "I listen to music while studying.", grade: 7},
                    {word: "read", meaning: "é–±è®€", example: "I read books before bed.", grade: 7},
                    {word: "write", meaning: "å¯«", example: "I write in my diary every day.", grade: 7},
                    {word: "go", meaning: "å»", example: "I go to school by bus.", grade: 7},
                    {word: "come", meaning: "ä¾†", example: "Please come to my house.", grade: 7},
                    {word: "walk", meaning: "èµ°è·¯", example: "I walk to school every morning.", grade: 7},
                    {word: "run", meaning: "è·‘", example: "I run in the park every weekend.", grade: 7}
                ]
            },
            food: {
                name: "é£Ÿç‰©èˆ‡é£²é£Ÿ",
                description: "å„é¡é£Ÿç‰©ã€é£²æ–™ã€ç”¨é¤ç›¸é—œè©å½™",
                words: [
                    {word: "rice", meaning: "ç±³é£¯", example: "I eat rice for lunch.", grade: 7},
                    {word: "bread", meaning: "éºµåŒ…", example: "I have bread for breakfast.", grade: 7},
                    {word: "apple", meaning: "è˜‹æœ", example: "An apple a day keeps the doctor away.", grade: 7},
                    {word: "banana", meaning: "é¦™è•‰", example: "Bananas are yellow and sweet.", grade: 7},
                    {word: "water", meaning: "æ°´", example: "I drink water when I'm thirsty.", grade: 7},
                    {word: "milk", meaning: "ç‰›å¥¶", example: "I drink milk every morning.", grade: 7},
                    {word: "breakfast", meaning: "æ—©é¤", example: "Breakfast is the most important meal.", grade: 7},
                    {word: "lunch", meaning: "åˆé¤", example: "I have lunch at school.", grade: 7},
                    {word: "dinner", meaning: "æ™šé¤", example: "We have dinner at 7 PM.", grade: 7},
                    {word: "chicken", meaning: "é›è‚‰", example: "I like fried chicken.", grade: 7},
                    {word: "fish", meaning: "é­š", example: "Fish is healthy food.", grade: 7},
                    {word: "vegetable", meaning: "è”¬èœ", example: "Vegetables are good for health.", grade: 8},
                    {word: "fruit", meaning: "æ°´æœ", example: "I eat fruit every day.", grade: 8},
                    {word: "juice", meaning: "æœæ±", example: "Orange juice is my favorite drink.", grade: 7},
                    {word: "tea", meaning: "èŒ¶", example: "My mother drinks tea every afternoon.", grade: 7}
                ]
            },
            time: {
                name: "æ™‚é–“èˆ‡æ—¥æœŸ",
                description: "æ™‚é–“ã€æ—¥æœŸã€æ˜ŸæœŸç›¸é—œè©å½™",
                words: [
                    {word: "morning", meaning: "æ—©ä¸Š", example: "I have breakfast in the morning.", grade: 7},
                    {word: "afternoon", meaning: "ä¸‹åˆ", example: "I play sports in the afternoon.", grade: 7},
                    {word: "evening", meaning: "æ™šä¸Š", example: "I do homework in the evening.", grade: 7},
                    {word: "night", meaning: "å¤œæ™š", example: "I sleep at night.", grade: 7},
                    {word: "today", meaning: "ä»Šå¤©", example: "Today is a sunny day.", grade: 7},
                    {word: "yesterday", meaning: "æ˜¨å¤©", example: "I went to the park yesterday.", grade: 7},
                    {word: "tomorrow", meaning: "æ˜å¤©", example: "I will visit my friend tomorrow.", grade: 7},
                    {word: "Monday", meaning: "æ˜ŸæœŸä¸€", example: "I go to school on Monday.", grade: 7},
                    {word: "Tuesday", meaning: "æ˜ŸæœŸäºŒ", example: "We have PE on Tuesday.", grade: 7},
                    {word: "Wednesday", meaning: "æ˜ŸæœŸä¸‰", example: "Wednesday is the middle of the week.", grade: 7},
                    {word: "Thursday", meaning: "æ˜ŸæœŸå››", example: "I have music class on Thursday.", grade: 7},
                    {word: "Friday", meaning: "æ˜ŸæœŸäº”", example: "Friday is the last school day.", grade: 7},
                    {word: "Saturday", meaning: "æ˜ŸæœŸå…­", example: "I sleep late on Saturday.", grade: 7},
                    {word: "Sunday", meaning: "æ˜ŸæœŸæ—¥", example: "Sunday is a holiday.", grade: 7},
                    {word: "week", meaning: "æ˜ŸæœŸ", example: "There are seven days in a week.", grade: 7}
                ]
            },
            body: {
                name: "èº«é«”èˆ‡å¥åº·",
                description: "èº«é«”éƒ¨ä½ã€å¥åº·ç‹€æ³ã€é†«ç™‚ç›¸é—œè©å½™",
                words: [
                    {word: "head", meaning: "é ­", example: "My head hurts.", grade: 7},
                    {word: "eye", meaning: "çœ¼ç›", example: "She has beautiful eyes.", grade: 7},
                    {word: "ear", meaning: "è€³æœµ", example: "I can't hear with my left ear.", grade: 7},
                    {word: "nose", meaning: "é¼»å­", example: "My nose is running.", grade: 7},
                    {word: "mouth", meaning: "å˜´å·´", example: "Open your mouth, please.", grade: 7},
                    {word: "hand", meaning: "æ‰‹", example: "Wash your hands before eating.", grade: 7},
                    {word: "foot", meaning: "è…³", example: "My foot is sore.", grade: 7},
                    {word: "healthy", meaning: "å¥åº·çš„", example: "I want to be healthy.", grade: 7},
                    {word: "sick", meaning: "ç”Ÿç—…çš„", example: "I feel sick today.", grade: 7},
                    {word: "doctor", meaning: "é†«ç”Ÿ", example: "The doctor is very kind.", grade: 7},
                    {word: "hospital", meaning: "é†«é™¢", example: "She works at the hospital.", grade: 7},
                    {word: "medicine", meaning: "è—¥", example: "Take your medicine after meals.", grade: 8}
                ]
            },
            clothes: {
                name: "è¡£è‘—èˆ‡è³¼ç‰©",
                description: "æœè£ã€é…ä»¶ã€è³¼ç‰©ç›¸é—œè©å½™",
                words: [
                    {word: "shirt", meaning: "è¥¯è¡«", example: "I wear a white shirt to school.", grade: 7},
                    {word: "pants", meaning: "é•·è¤²", example: "These pants are too long.", grade: 7},
                    {word: "shoes", meaning: "é‹å­", example: "I need new shoes.", grade: 7},
                    {word: "dress", meaning: "æ´‹è£", example: "She looks pretty in that dress.", grade: 7},
                    {word: "jacket", meaning: "å¤¾å…‹", example: "It's cold, wear your jacket.", grade: 7},
                    {word: "buy", meaning: "è²·", example: "I want to buy a new book.", grade: 7},
                    {word: "sell", meaning: "è³£", example: "They sell fresh fruit here.", grade: 7},
                    {word: "price", meaning: "åƒ¹æ ¼", example: "What's the price of this shirt?", grade: 8},
                    {word: "cheap", meaning: "ä¾¿å®œçš„", example: "This store has cheap clothes.", grade: 7},
                    {word: "expensive", meaning: "æ˜‚è²´çš„", example: "That car is too expensive.", grade: 8}
                ]
            },
            home: {
                name: "ä½å®¶èˆ‡ç’°å¢ƒ",
                description: "å®¶åº­ç’°å¢ƒã€æˆ¿é–“ã€å®¶å…·ç›¸é—œè©å½™",
                words: [
                    {word: "home", meaning: "å®¶", example: "I do my homework at home.", grade: 7},
                    {word: "house", meaning: "æˆ¿å­", example: "We live in a small house.", grade: 7},
                    {word: "room", meaning: "æˆ¿é–“", example: "My room is upstairs.", grade: 7},
                    {word: "kitchen", meaning: "å»šæˆ¿", example: "Mom is cooking in the kitchen.", grade: 7},
                    {word: "bathroom", meaning: "æµ´å®¤", example: "The bathroom is clean.", grade: 7},
                    {word: "bedroom", meaning: "è‡¥å®¤", example: "I sleep in my bedroom.", grade: 7},
                    {word: "living room", meaning: "å®¢å»³", example: "We watch TV in the living room.", grade: 7},
                    {word: "door", meaning: "é–€", example: "Please close the door.", grade: 7},
                    {word: "window", meaning: "çª—æˆ¶", example: "Open the window, please.", grade: 7},
                    {word: "table", meaning: "æ¡Œå­", example: "Put the book on the table.", grade: 7},
                    {word: "chair", meaning: "æ¤…å­", example: "Sit on the chair.", grade: 7},
                    {word: "bed", meaning: "åºŠ", example: "I make my bed every morning.", grade: 7}
                ]
            },
            numbers: {
                name: "æ•¸å­—èˆ‡è¨ˆç®—",
                description: "æ•¸å­—ã€æ•¸å­¸é‹ç®—ç›¸é—œè©å½™",
                words: [
                    {word: "zero", meaning: "é›¶", example: "Zero plus one equals one.", grade: 7},
                    {word: "first", meaning: "ç¬¬ä¸€", example: "I'm first in line.", grade: 7},
                    {word: "second", meaning: "ç¬¬äºŒ", example: "This is my second try.", grade: 7},
                    {word: "third", meaning: "ç¬¬ä¸‰", example: "He came in third place.", grade: 7},
                    {word: "add", meaning: "åŠ ", example: "Add these two numbers.", grade: 7},
                    {word: "minus", meaning: "æ¸›", example: "Ten minus three equals seven.", grade: 7},
                    {word: "multiply", meaning: "ä¹˜", example: "Multiply five by two.", grade: 8},
                    {word: "divide", meaning: "é™¤", example: "Divide ten by two.", grade: 8},
                    {word: "equal", meaning: "ç­‰æ–¼", example: "Two plus two equals four.", grade: 7},
                    {word: "count", meaning: "æ•¸", example: "Can you count to 100?", grade: 7}
                ]
            },
            transport: {
                name: "äº¤é€šèˆ‡æ—…éŠ",
                description: "äº¤é€šå·¥å…·ã€æ—…è¡Œç›¸é—œè©å½™",
                words: [
                    {word: "car", meaning: "æ±½è»Š", example: "My father drives a car to work.", grade: 7},
                    {word: "bus", meaning: "å…¬è»Š", example: "I take the bus to school.", grade: 7},
                    {word: "train", meaning: "ç«è»Š", example: "The train is fast.", grade: 7},
                    {word: "bike", meaning: "è…³è¸è»Š", example: "I ride my bike to the park.", grade: 7},
                    {word: "airplane", meaning: "é£›æ©Ÿ", example: "We travel by airplane.", grade: 7},
                    {word: "walk", meaning: "èµ°è·¯", example: "I walk to school every morning.", grade: 7},
                    {word: "drive", meaning: "é–‹è»Š", example: "Can you drive a car?", grade: 8},
                    {word: "ride", meaning: "é¨ï¼›æ­ä¹˜", example: "I ride the bus every day.", grade: 7},
                    {word: "trip", meaning: "æ—…è¡Œ", example: "We had a great trip.", grade: 8},
                    {word: "travel", meaning: "æ—…éŠ", example: "I love to travel.", grade: 8}
                ]
            },
            sports: {
                name: "é‹å‹•èˆ‡ä¼‘é–’",
                description: "é‹å‹•ã€ä¼‘é–’æ´»å‹•ç›¸é—œè©å½™",
                words: [
                    {word: "basketball", meaning: "ç±ƒçƒ", example: "I play basketball after school.", grade: 7},
                    {word: "baseball", meaning: "æ£’çƒ", example: "Baseball is popular in Taiwan.", grade: 7},
                    {word: "soccer", meaning: "è¶³çƒ", example: "Let's play soccer!", grade: 7},
                    {word: "swim", meaning: "æ¸¸æ³³", example: "I can swim very fast.", grade: 7},
                    {word: "run", meaning: "è·‘", example: "I run every morning.", grade: 7},
                    {word: "jump", meaning: "è·³", example: "Can you jump high?", grade: 7},
                    {word: "game", meaning: "éŠæˆ²ï¼›æ¯”è³½", example: "We won the game.", grade: 7},
                    {word: "sport", meaning: "é‹å‹•", example: "What's your favorite sport?", grade: 7},
                    {word: "music", meaning: "éŸ³æ¨‚", example: "I listen to music every day.", grade: 7},
                    {word: "movie", meaning: "é›»å½±", example: "Let's watch a movie.", grade: 7}
                ]
            },
            jobs: {
                name: "è·æ¥­èˆ‡å·¥ä½œ",
                description: "å„ç¨®è·æ¥­ã€å·¥ä½œç›¸é—œè©å½™",
                words: [
                    {word: "work", meaning: "å·¥ä½œ", example: "I work hard every day.", grade: 7},
                    {word: "job", meaning: "å·¥ä½œï¼›è·æ¥­", example: "She has a good job.", grade: 8},
                    {word: "teacher", meaning: "è€å¸«", example: "My teacher is very nice.", grade: 7},
                    {word: "doctor", meaning: "é†«ç”Ÿ", example: "The doctor helps sick people.", grade: 7},
                    {word: "nurse", meaning: "è­·å£«", example: "The nurse takes care of patients.", grade: 8},
                    {word: "police", meaning: "è­¦å¯Ÿ", example: "The police keep us safe.", grade: 7},
                    {word: "driver", meaning: "å¸æ©Ÿ", example: "The bus driver is friendly.", grade: 8},
                    {word: "cook", meaning: "å»šå¸«ï¼›ç…®", example: "The cook makes delicious food.", grade: 7},
                    {word: "office", meaning: "è¾¦å…¬å®¤", example: "Dad works in an office.", grade: 8},
                    {word: "company", meaning: "å…¬å¸", example: "She works for a big company.", grade: 8}
                ]
            },
            weather: {
                name: "å¤©æ°£èˆ‡å­£ç¯€",
                description: "å¤©æ°£ç‹€æ³ã€å­£ç¯€ç›¸é—œè©å½™",
                words: [
                    {word: "sunny", meaning: "æ™´æœ—çš„", example: "It is sunny today.", grade: 7},
                    {word: "rainy", meaning: "ä¸‹é›¨çš„", example: "The weather is rainy.", grade: 7},
                    {word: "cloudy", meaning: "å¤šé›²çš„", example: "It's cloudy this morning.", grade: 7},
                    {word: "hot", meaning: "ç†±çš„", example: "Summer is very hot.", grade: 7},
                    {word: "cold", meaning: "å†·çš„", example: "I feel cold in winter.", grade: 7},
                    {word: "warm", meaning: "æº«æš–çš„", example: "Spring is warm.", grade: 7},
                    {word: "cool", meaning: "æ¶¼çˆ½çš„", example: "Autumn is cool.", grade: 7},
                    {word: "spring", meaning: "æ˜¥å¤©", example: "Flowers bloom in spring.", grade: 7},
                    {word: "summer", meaning: "å¤å¤©", example: "We swim in summer.", grade: 7},
                    {word: "autumn", meaning: "ç§‹å¤©", example: "Leaves fall in autumn.", grade: 7},
                    {word: "winter", meaning: "å†¬å¤©", example: "It's cold in winter.", grade: 7}
                ]
            },
            animals: {
                name: "å‹•ç‰©èˆ‡è‡ªç„¶",
                description: "å‹•ç‰©ã€æ¤ç‰©ã€è‡ªç„¶ç’°å¢ƒç›¸é—œè©å½™",
                words: [
                    {word: "dog", meaning: "ç‹—", example: "The dog is running fast.", grade: 7},
                    {word: "cat", meaning: "è²“", example: "My cat is sleeping.", grade: 7},
                    {word: "bird", meaning: "é³¥", example: "Birds can fly.", grade: 7},
                    {word: "fish", meaning: "é­š", example: "Fish live in water.", grade: 7},
                    {word: "tree", meaning: "æ¨¹", example: "The tree is very tall.", grade: 7},
                    {word: "flower", meaning: "èŠ±", example: "The flowers are beautiful.", grade: 7},
                    {word: "animal", meaning: "å‹•ç‰©", example: "I love animals.", grade: 7},
                    {word: "pet", meaning: "å¯µç‰©", example: "Do you have a pet?", grade: 7},
                    {word: "zoo", meaning: "å‹•ç‰©åœ’", example: "Let's go to the zoo.", grade: 7},
                    {word: "park", meaning: "å…¬åœ’", example: "Children play in the park.", grade: 7}
                ]
            },
            tech: {
                name: "ç§‘æŠ€èˆ‡åª’é«”",
                description: "ç§‘æŠ€ç”¢å“ã€ç¶²è·¯ã€åª’é«”ç›¸é—œè©å½™",
                words: [
                    {word: "computer", meaning: "é›»è…¦", example: "I use a computer for homework.", grade: 7},
                    {word: "phone", meaning: "é›»è©±", example: "My phone is ringing.", grade: 7},
                    {word: "internet", meaning: "ç¶²è·¯", example: "I search on the internet.", grade: 8},
                    {word: "email", meaning: "é›»å­éƒµä»¶", example: "Send me an email.", grade: 8},
                    {word: "website", meaning: "ç¶²ç«™", example: "This website is useful.", grade: 8},
                    {word: "game", meaning: "éŠæˆ²", example: "I play games on my phone.", grade: 7},
                    {word: "video", meaning: "å½±ç‰‡", example: "Watch this video.", grade: 8},
                    {word: "TV", meaning: "é›»è¦–", example: "I watch TV after dinner.", grade: 7},
                    {word: "news", meaning: "æ–°è", example: "I read the news every day.", grade: 8},
                    {word: "message", meaning: "è¨Šæ¯", example: "I got your message.", grade: 8}
                ]
            }
        };

        // ä¸è¦å‰‡å‹•è©æ¸…å–®ï¼ˆæ ¹æ“šæ•™è‚²éƒ¨ç ”ç©¶å ±å‘Šï¼‰
        const irregularVerbs = {
            // æœ€é«˜å„ªå…ˆç´š11å€‹å‹•è©ï¼ˆå ç¸½ä½¿ç”¨é‡50%ï¼‰
            basic: [
                {base: 'be', past: 'was/were', pp: 'been', meaning: 'æ˜¯'},
                {base: 'have', past: 'had', pp: 'had', meaning: 'æœ‰'},
                {base: 'do', past: 'did', pp: 'done', meaning: 'åš'},
                {base: 'say', past: 'said', pp: 'said', meaning: 'èªª'},
                {base: 'go', past: 'went', pp: 'gone', meaning: 'å»'},
                {base: 'get', past: 'got', pp: 'got', meaning: 'å¾—åˆ°'},
                {base: 'make', past: 'made', pp: 'made', meaning: 'è£½ä½œ'},
                {base: 'know', past: 'knew', pp: 'known', meaning: 'çŸ¥é“'},
                {base: 'think', past: 'thought', pp: 'thought', meaning: 'æƒ³'},
                {base: 'take', past: 'took', pp: 'taken', meaning: 'æ‹¿'},
                {base: 'see', past: 'saw', pp: 'seen', meaning: 'çœ‹è¦‹'}
            ],
            
            // æ¬¡è¦39å€‹å‹•è©
            intermediate: [
                {base: 'come', past: 'came', pp: 'come', meaning: 'ä¾†'},
                {base: 'give', past: 'gave', pp: 'given', meaning: 'çµ¦'},
                {base: 'find', past: 'found', pp: 'found', meaning: 'æ‰¾åˆ°'},
                {base: 'tell', past: 'told', pp: 'told', meaning: 'å‘Šè¨´'},
                {base: 'become', past: 'became', pp: 'become', meaning: 'è®Šæˆ'},
                {base: 'leave', past: 'left', pp: 'left', meaning: 'é›¢é–‹'},
                {base: 'feel', past: 'felt', pp: 'felt', meaning: 'æ„Ÿè¦º'},
                {base: 'bring', past: 'brought', pp: 'brought', meaning: 'å¸¶ä¾†'},
                {base: 'begin', past: 'began', pp: 'begun', meaning: 'é–‹å§‹'},
                {base: 'keep', past: 'kept', pp: 'kept', meaning: 'ä¿æŒ'},
                {base: 'hold', past: 'held', pp: 'held', meaning: 'æ‹¿è‘—'},
                {base: 'write', past: 'wrote', pp: 'written', meaning: 'å¯«'},
                {base: 'stand', past: 'stood', pp: 'stood', meaning: 'ç«™'},
                {base: 'hear', past: 'heard', pp: 'heard', meaning: 'è½è¦‹'},
                {base: 'let', past: 'let', pp: 'let', meaning: 'è®“'},
                {base: 'mean', past: 'meant', pp: 'meant', meaning: 'æ„æ€æ˜¯'},
                {base: 'set', past: 'set', pp: 'set', meaning: 'è¨­å®š'},
                {base: 'meet', past: 'met', pp: 'met', meaning: 'é‡è¦‹'},
                {base: 'run', past: 'ran', pp: 'run', meaning: 'è·‘'},
                {base: 'pay', past: 'paid', pp: 'paid', meaning: 'ä»˜éŒ¢'},
                {base: 'sit', past: 'sat', pp: 'sat', meaning: 'å'},
                {base: 'speak', past: 'spoke', pp: 'spoken', meaning: 'èªªè©±'},
                {base: 'lie', past: 'lay', pp: 'lain', meaning: 'èºº'},
                {base: 'lead', past: 'led', pp: 'led', meaning: 'é ˜å°'},
                {base: 'read', past: 'read', pp: 'read', meaning: 'è®€'},
                {base: 'grow', past: 'grew', pp: 'grown', meaning: 'é•·å¤§'},
                {base: 'lose', past: 'lost', pp: 'lost', meaning: 'å¤±å»'},
                {base: 'fall', past: 'fell', pp: 'fallen', meaning: 'æ‰è½'},
                {base: 'send', past: 'sent', pp: 'sent', meaning: 'é€'},
                {base: 'build', past: 'built', pp: 'built', meaning: 'å»ºé€ '},
                {base: 'understand', past: 'understood', pp: 'understood', meaning: 'ç†è§£'},
                {base: 'draw', past: 'drew', pp: 'drawn', meaning: 'ç•«'},
                {base: 'break', past: 'broke', pp: 'broken', meaning: 'æ‰“ç ´'},
                {base: 'spend', past: 'spent', pp: 'spent', meaning: 'èŠ±è²»'},
                {base: 'cut', past: 'cut', pp: 'cut', meaning: 'åˆ‡'},
                {base: 'rise', past: 'rose', pp: 'risen', meaning: 'ä¸Šå‡'},
                {base: 'drive', past: 'drove', pp: 'driven', meaning: 'é–‹è»Š'},
                {base: 'buy', past: 'bought', pp: 'bought', meaning: 'è²·'},
                {base: 'wear', past: 'wore', pp: 'worn', meaning: 'ç©¿'}
            ]
        };

        // æ–°å¢çš„ç¼ºå¤±å‡½æ•¸
        function updateThemeInfo() {
            const themeSelect = document.getElementById('curriculumTheme');
            const themeInfo = document.getElementById('themeInfo');
            const themeDesc = document.getElementById('themeDescription');
            const themeWordCount = document.getElementById('themeWordCount');
            
            const selectedTheme = themeSelect.value;
            
            if (selectedTheme && curriculum108[selectedTheme]) {
                const theme = curriculum108[selectedTheme];
                const gradeLevel = document.getElementById('gradeLevel').value;
                
                let filteredWords = theme.words;
                if (gradeLevel !== 'all') {
                    filteredWords = theme.words.filter(word => word.grade === parseInt(gradeLevel));
                }
                
                themeDesc.textContent = theme.description;
                themeWordCount.textContent = filteredWords.length;
                themeInfo.style.display = 'block';
            } else {
                themeInfo.style.display = 'none';
            }
        }

        function loadCurriculumWords() {
            const themeSelect = document.getElementById('curriculumTheme');
            const gradeLevel = document.getElementById('gradeLevel').value;
            const selectedTheme = themeSelect.value;
            
            if (!selectedTheme) {
                alert('è«‹å…ˆé¸æ“‡ä¸»é¡Œï¼');
                return;
            }
            
            const theme = curriculum108[selectedTheme];
            let wordsToLoad = theme.words;
            
            if (gradeLevel !== 'all') {
                wordsToLoad = theme.words.filter(word => word.grade === parseInt(gradeLevel));
            }
            
            let addedCount = 0;
            wordsToLoad.forEach(wordData => {
                // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨
                const exists = vocabulary.some(existing => existing.word.toLowerCase() === wordData.word.toLowerCase());
                if (!exists) {
                    vocabulary.push({
                        word: wordData.word,
                        meaning: wordData.meaning,
                        example: wordData.example || '',
                        theme: selectedTheme,
                        grade: wordData.grade,
                        learned: false,
                        mastery: 0,
                        addedDate: new Date().toISOString(),
                        reviewCount: 0,
                        nextReviewDate: getNextReviewDate(0)
                    });
                    addedCount++;
                }
            });
            
            localStorage.setItem('vocabulary', JSON.stringify(vocabulary));
            updateWordCount();
            updateLearningProgress();
            
            alert(`æˆåŠŸè¼‰å…¥ ${addedCount} å€‹æ–°å–®å­—ï¼ˆè·³é ${wordsToLoad.length - addedCount} å€‹é‡è¤‡å–®å­—ï¼‰ï¼`);
        }

        function showLearningPath() {
            const learningPathHTML = `
                <div style="background: #e8f5e8; padding: 15px; border-radius: 10px; margin: 15px 0;">
                    <h3>ğŸ¯ æ™ºæ…§å­¸ç¿’è·¯å¾‘å»ºè­°</h3>
                    <ol style="padding-left: 20px; margin: 10px 0;">
                        <li><strong>ç¬¬ä¸€éšæ®µï¼š</strong>åŸºç¤è©å½™ï¼ˆå®¶åº­ã€å­¸æ ¡ã€æ—¥å¸¸æ´»å‹•ï¼‰</li>
                        <li><strong>ç¬¬äºŒéšæ®µï¼š</strong>å¯¦ç”¨è©å½™ï¼ˆé£Ÿç‰©ã€æ™‚é–“ã€èº«é«”ï¼‰</li>
                        <li><strong>ç¬¬ä¸‰éšæ®µï¼š</strong>æ“´å±•è©å½™ï¼ˆé‹å‹•ã€è·æ¥­ã€ç§‘æŠ€ï¼‰</li>
                        <li><strong>ç¬¬å››éšæ®µï¼š</strong>é€²éšè©å½™ï¼ˆå¤©æ°£ã€å‹•ç‰©ã€äº¤é€šï¼‰</li>
                    </ol>
                    <p style="color: #666; font-size: 0.9em;">ğŸ’¡ å»ºè­°æ¯å¤©å­¸ç¿’10-15å€‹æ–°å–®å­—ï¼Œä¸¦å®šæœŸè¤‡ç¿’èˆŠå–®å­—ï¼</p>
                </div>
            `;
            
            const existingPath = document.querySelector('.learning-path');
            if (existingPath) {
                existingPath.remove();
            }
            
            const pathDiv = document.createElement('div');
            pathDiv.className = 'learning-path';
            pathDiv.innerHTML = learningPathHTML;
            
            const themeSection = document.querySelector('#vocabulary .input-group').parentNode;
            themeSection.appendChild(pathDiv);
        }

        function updateWordCount() {
            document.getElementById('wordCount').textContent = vocabulary.length;
        }

        function updateLearningProgress() {
            const totalWords = vocabulary.length;
            const learnedWords = vocabulary.filter(word => word.mastery >= 60).length;
            const newWords = vocabulary.filter(word => word.mastery === 0).length;
            const reviewingWords = vocabulary.filter(word => word.mastery > 0 && word.mastery < 80).length;
            const masteredWords = vocabulary.filter(word => word.mastery >= 80).length;
            
            if (totalWords > 0) {
                const progressElement = document.getElementById('learningProgress');
                if (progressElement) {
                    progressElement.style.display = 'block';
                    
                    const progressPercent = Math.round((learnedWords / totalWords) * 100);
                    document.getElementById('vocabularyProgress').style.width = progressPercent + '%';
                    document.getElementById('learnedWords').textContent = learnedWords;
                    document.getElementById('totalWords').textContent = totalWords;
                    document.getElementById('newWordsCount').textContent = newWords;
                    document.getElementById('reviewingCount').textContent = reviewingWords;
                    document.getElementById('masteredCount').textContent = masteredWords;
                }
            }
        }

        function startExamplePractice() {
            const wordsWithExamples = vocabulary.filter(word => word.example);
            
            if (wordsWithExamples.length === 0) {
                alert('æ²’æœ‰åŒ…å«ä¾‹å¥çš„å–®å­—ï¼è«‹å…ˆæ·»åŠ ä¸€äº›ä¾‹å¥ã€‚');
                return;
            }
            
            const randomWord = wordsWithExamples[Math.floor(Math.random() * wordsWithExamples.length)];
            currentWordTest = randomWord;
            
            // å°‡ä¾‹å¥ä¸­çš„å–®å­—ç”¨ç©ºæ ¼ä»£æ›¿
            const exampleWithBlank = randomWord.example.replace(new RegExp(randomWord.word, 'gi'), '____');
            
            document.getElementById('wordDisplay').innerHTML = `
                <h3>è«‹å¡«å…¥æ­£ç¢ºçš„å–®å­—ï¼š</h3>
                <p style="font-size: 1.2em; color: #667eea; margin: 15px 0;">${exampleWithBlank}</p>
                <p style="color: #666;">æç¤ºï¼š${randomWord.meaning}</p>
                <input type="text" id="exampleAnswer" placeholder="è¼¸å…¥è‹±æ–‡å–®å­—">
                <button class="btn" onclick="checkExampleAnswer()">æª¢æŸ¥ç­”æ¡ˆ</button>
            `;
            
            document.getElementById('exampleAnswer').focus();
        }

        function checkExampleAnswer() {
            const userAnswer = document.getElementById('exampleAnswer').value.trim();
            const correct = userAnswer.toLowerCase() === currentWordTest.word.toLowerCase();
            
            if (correct) {
                currentWordTest.mastery = Math.min(100, (currentWordTest.mastery || 0) + 15);
                playSound('correct');
            } else {
                currentWordTest.mastery = Math.max(0, (currentWordTest.mastery || 0) - 5);
                playSound('error');
            }
            
            localStorage.setItem('vocabulary', JSON.stringify(vocabulary));
            updateLearningProgress();
            
            document.getElementById('wordDisplay').innerHTML = `
                <h3>${correct ? 'âœ… æ­£ç¢ºï¼' : 'âŒ éŒ¯èª¤'}</h3>
                <p><strong>æ­£ç¢ºç­”æ¡ˆï¼š</strong>${currentWordTest.word}</p>
                <p><strong>å®Œæ•´ä¾‹å¥ï¼š</strong>${currentWordTest.example}</p>
                <p><strong>ä¸­æ–‡æ„æ€ï¼š</strong>${currentWordTest.meaning}</p>
                <button class="btn" onclick="startExamplePractice()">ä¸‹ä¸€é¡Œ</button>
            `;
        }

        function startSpellingTest() {
            if (vocabulary.length === 0) {
                alert('è«‹å…ˆæ–°å¢ä¸€äº›å–®å­—ï¼');
                return;
            }
            
            const randomWord = vocabulary[Math.floor(Math.random() * vocabulary.length)];
            currentWordTest = randomWord;
            
            document.getElementById('wordDisplay').innerHTML = `
                <h3>è«‹æ‹¼å‡ºé€™å€‹å–®å­—ï¼š</h3>
                <p style="font-size: 1.5em; color: #667eea; font-weight: bold; margin: 15px 0;">${randomWord.meaning}</p>
                ${randomWord.example ? `<p style="color: #666; font-style: italic;">"${randomWord.example}"</p>` : ''}
                <input type="text" id="spellingAnswer" placeholder="è¼¸å…¥è‹±æ–‡æ‹¼å­—">
                <button class="btn" onclick="checkSpellingAnswer()">æª¢æŸ¥æ‹¼å­—</button>
            `;
            
            document.getElementById('spellingAnswer').focus();
        }

        function checkSpellingAnswer() {
            const userAnswer = document.getElementById('spellingAnswer').value.trim();
            const correct = userAnswer.toLowerCase() === currentWordTest.word.toLowerCase();
            
            if (correct) {
                currentWordTest.mastery = Math.min(100, (currentWordTest.mastery || 0) + 20);
                playSound('correct');
            } else {
                currentWordTest.mastery = Math.max(0, (currentWordTest.mastery || 0) - 10);
                playSound('error');
            }
            
            localStorage.setItem('vocabulary', JSON.stringify(vocabulary));
            updateLearningProgress();
            
            document.getElementById('wordDisplay').innerHTML = `
                <h3>${correct ? 'âœ… æ­£ç¢ºï¼' : 'âŒ éŒ¯èª¤'}</h3>
                <p><strong>æ­£ç¢ºæ‹¼å­—ï¼š</strong>${currentWordTest.word}</p>
                <p><strong>ä½ çš„æ‹¼å­—ï¼š</strong>${userAnswer}</p>
                <p><strong>ä¸­æ–‡æ„æ€ï¼š</strong>${currentWordTest.meaning}</p>
                <button class="btn" onclick="startSpellingTest()">ä¸‹ä¸€é¡Œ</button>
            `;
        }

        function reviewWords() {
            const wordsToReview = vocabulary.filter(word => {
                if (!word.nextReviewDate) return true; // æ–°å–®å­—
                return new Date(word.nextReviewDate) <= new Date(); // åˆ°æœŸçš„å–®å­—
            });
            
            if (wordsToReview.length === 0) {
                alert('ç›®å‰æ²’æœ‰éœ€è¦è¤‡ç¿’çš„å–®å­—ï¼');
                return;
            }
            
            // æŒ‰æŒæ¡åº¦æ’åºï¼Œå„ªå…ˆè¤‡ç¿’æŒæ¡åº¦ä½çš„
            wordsToReview.sort((a, b) => (a.mastery || 0) - (b.mastery || 0));
            
            currentWordTest = wordsToReview[0];
            
            document.getElementById('wordDisplay').innerHTML = `
                <h3>ğŸ”„ æ™ºæ…§è¤‡ç¿’</h3>
                <p style="color: #666;">å¾…è¤‡ç¿’å–®å­—ï¼š${wordsToReview.length} å€‹</p>
                <div style="margin: 20px 0;">
                    <p style="font-size: 1.5em; color: #667eea; font-weight: bold;">${currentWordTest.word}</p>
                    <div style="margin: 10px 0;">
                        <span style="font-size: 0.9em; color: #666;">æŒæ¡åº¦ï¼š</span>
                        <div style="width: 100%; height: 10px; background: #e0e0e0; border-radius: 5px; display: inline-block; margin: 0 10px; vertical-align: middle;">
                            <div style="width: ${currentWordTest.mastery || 0}%; height: 100%; background: #4caf50; border-radius: 5px;"></div>
                        </div>
                        <span style="font-size: 0.9em; color: #666;">${currentWordTest.mastery || 0}%</span>
                    </div>
                </div>
                <input type="text" id="reviewAnswer" placeholder="è¼¸å…¥ä¸­æ–‡æ„æ€">
                <button class="btn" onclick="checkReviewAnswer()">æª¢æŸ¥ç­”æ¡ˆ</button>
                <button class="btn" onclick="showReviewAnswer()" style="background: #6c757d;">é¡¯ç¤ºç­”æ¡ˆ</button>
            `;
            
            document.getElementById('reviewAnswer').focus();
        }

        function checkReviewAnswer() {
            const userAnswer = document.getElementById('reviewAnswer').value.trim();
            const correct = userAnswer === currentWordTest.meaning;
            
            if (correct) {
                currentWordTest.mastery = Math.min(100, (currentWordTest.mastery || 0) + 10);
                currentWordTest.reviewCount = (currentWordTest.reviewCount || 0) + 1;
                currentWordTest.nextReviewDate = getNextReviewDate(currentWordTest.reviewCount);
                playSound('correct');
            } else {
                currentWordTest.mastery = Math.max(0, (currentWordTest.mastery || 0) - 5);
                playSound('error');
            }
            
            localStorage.setItem('vocabulary', JSON.stringify(vocabulary));
            updateLearningProgress();
            
            document.getElementById('wordDisplay').innerHTML = `
                <h3>${correct ? 'âœ… æ­£ç¢ºï¼' : 'âŒ éŒ¯èª¤'}</h3>
                <p><strong>${currentWordTest.word}</strong> = ${currentWordTest.meaning}</p>
                <p>ä½ çš„ç­”æ¡ˆï¼š${userAnswer}</p>
                ${currentWordTest.example ? `<p style="margin-top: 10px; font-style: italic;">"${currentWordTest.example}"</p>` : ''}
                <button class="btn" onclick="reviewWords()">ç¹¼çºŒè¤‡ç¿’</button>
            `;
        }

        function showReviewAnswer() {
            currentWordTest.mastery = Math.max(0, (currentWordTest.mastery || 0) - 5);
            localStorage.setItem('vocabulary', JSON.stringify(vocabulary));
            updateLearningProgress();
            
            document.getElementById('wordDisplay').innerHTML = `
                <h3>ğŸ’¡ ç­”æ¡ˆæ­æ›‰</h3>
                <p><strong>${currentWordTest.word}</strong> = ${currentWordTest.meaning}</p>
                ${currentWordTest.example ? `<p style="margin-top: 10px; font-style: italic;">"${currentWordTest.example}"</p>` : ''}
                <button class="btn" onclick="reviewWords()">ç¹¼çºŒè¤‡ç¿’</button>
            `;
        }

        // éŒ¯é¡Œæœ¬åŠŸèƒ½
        function switchErrorTab(tabName) {
            // åˆ‡æ›æ¨™ç±¤é æ´»å‹•ç‹€æ…‹
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // éš±è—æ‰€æœ‰å…§å®¹
            document.querySelectorAll('.error-tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // é¡¯ç¤ºé¸ä¸­çš„å…§å®¹
            document.getElementById('error' + tabName.charAt(0).toUpperCase() + tabName.slice(1) + 'Tab').style.display = 'block';
            
            // æ ¹æ“šæ¨™ç±¤é è¼‰å…¥ç›¸æ‡‰å…§å®¹
            if (tabName === 'list') {
                showErrorList();
            } else if (tabName === 'analysis') {
                showErrorAnalysis();
            } else if (tabName === 'review') {
                updateReviewContent();
            }
        }

        function addError() {
            const error = {
                id: Date.now(),
                subject: document.getElementById('errorSubject').value,
                chapter: document.getElementById('errorChapter').value,
                question: document.getElementById('errorQuestion').value,
                myAnswer: document.getElementById('errorMyAnswer').value,
                correctAnswer: document.getElementById('errorCorrectAnswer').value,
                solution: document.getElementById('errorSolution').value,
                reason: document.getElementById('errorReason').value,
                difficulty: parseInt(document.getElementById('errorDifficulty').value),
                createDate: new Date().toISOString(),
                reviewDates: [],
                reviews: 0,
                mastered: false,
                nextReviewDate: getNextReviewDate(0)
            };
            
            if (!error.question || !error.correctAnswer) {
                alert('è«‹è‡³å°‘å¡«å¯«é¡Œç›®å’Œæ­£ç¢ºç­”æ¡ˆï¼');
                return;
            }
            
            errors.push(error);
            localStorage.setItem('errors', JSON.stringify(errors));
            
            alert('éŒ¯é¡Œå·²å„²å­˜ï¼');
            clearErrorForm();
            updateErrorStats();
        }

        function clearErrorForm() {
            // é‡æ–°é¡¯ç¤ºå®Œæ•´çš„æ–°å¢éŒ¯é¡Œè¡¨å–®
            document.getElementById('errorAddTab').innerHTML = `
                <div class="input-group">
                    <label>ç§‘ç›®ï¼š</label>
                    <select id="errorSubject">
                        <option value="math">æ•¸å­¸</option>
                        <option value="english">è‹±èª</option>
                        <option value="physics">ç‰©ç†</option>
                        <option value="chemistry">åŒ–å­¸</option>
                        <option value="other">å…¶ä»–</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>ç« ç¯€/å–®å…ƒï¼š</label>
                    <input type="text" id="errorChapter" placeholder="ä¾‹å¦‚ï¼šäºŒæ¬¡æ–¹ç¨‹å¼">
                </div>
                
                <div class="input-group">
                    <label>é¡Œç›®ï¼š</label>
                    <textarea id="errorQuestion" rows="3" placeholder="è¼¸å…¥é¡Œç›®å…§å®¹"></textarea>
                </div>
                
                <div class="input-group">
                    <label>æˆ‘çš„ç­”æ¡ˆï¼ˆéŒ¯èª¤ï¼‰ï¼š</label>
                    <input type="text" id="errorMyAnswer" placeholder="è¼¸å…¥éŒ¯èª¤ç­”æ¡ˆ">
                </div>
                
                <div class="input-group">
                    <label>æ­£ç¢ºç­”æ¡ˆï¼š</label>
                    <input type="text" id="errorCorrectAnswer" placeholder="è¼¸å…¥æ­£ç¢ºç­”æ¡ˆ">
                </div>
                
                <div class="input-group">
                    <label>è§£é¡Œæ­¥é©Ÿï¼š</label>
                    <textarea id="errorSolution" rows="3" placeholder="è©³ç´°è§£é¡Œéç¨‹"></textarea>
                </div>
                
                <div class="input-group">
                    <label>éŒ¯èª¤åŸå› ï¼š</label>
                    <textarea id="errorReason" rows="2" placeholder="åˆ†æéŒ¯èª¤åŸå› "></textarea>
                </div>
                
                <div class="input-group">
                    <label>é›£åº¦ï¼š</label>
                    <select id="errorDifficulty">
                        <option value="1">â­ ç°¡å–®</option>
                        <option value="2" selected>â­â­ ä¸­ç­‰</option>
                        <option value="3">â­â­â­ å›°é›£</option>
                    </select>
                </div>
                
                <button class="btn" onclick="addError()">å„²å­˜éŒ¯é¡Œ</button>
                <button class="btn btn-secondary" onclick="clearErrorForm()">æ¸…é™¤è¡¨å–®</button>
                <button class="btn" onclick="importFromQuestions()" style="background: #17a2b8;">å¾é¡Œåº«åŒ¯å…¥</button>
            `;
        }

        function getNextReviewDate(reviewCount) {
            // è‰¾è³“æµ©æ–¯éºå¿˜æ›²ç·šï¼š1å¤©ã€3å¤©ã€7å¤©ã€15å¤©ã€30å¤©
            const intervals = [1, 3, 7, 15, 30];
            if (reviewCount >= intervals.length) return null;
            
            const date = new Date();
            date.setDate(date.getDate() + intervals[reviewCount]);
            return date.toISOString();
        }

        function updateErrorStats() {
            const total = errors.length;
            const reviewed = errors.filter(e => e.reviews > 0).length;
            const mastered = errors.filter(e => e.mastered).length;
            
            document.getElementById('errorTotal').textContent = total;
            document.getElementById('errorReviewed').textContent = reviewed;
            document.getElementById('errorMastered').textContent = mastered;
        }

        function showErrorList() {
            const content = document.getElementById('errorListContent');
            
            if (errors.length === 0) {
                content.innerHTML = '<p style="text-align: center; color: #666; margin: 20px 0;">é‚„æ²’æœ‰éŒ¯é¡Œè¨˜éŒ„</p>';
                return;
            }
            
            let html = '';
            errors.forEach(error => {
                const subjectClass = `subject-${error.subject}`;
                const date = new Date(error.createDate).toLocaleDateString('zh-TW');
                const difficultyStars = 'â­'.repeat(error.difficulty);
                
                html += `
                    <div class="error-item">
                        <div class="error-item-header">
                            <span class="subject-tag ${subjectClass}">${getSubjectName(error.subject)}</span>
                            <span class="difficulty-stars">${difficultyStars}</span>
                        </div>
                        <h4>${error.chapter || 'æœªåˆ†é¡'}</h4>
                        <p><strong>é¡Œç›®ï¼š</strong>${error.question}</p>
                        <p><strong>æ­£ç¢ºç­”æ¡ˆï¼š</strong>${error.correctAnswer}</p>
                        <p><strong>éŒ¯èª¤åŸå› ï¼š</strong>${error.reason || 'æœªå¡«å¯«'}</p>
                        <div class="review-schedule">
                            <div class="review-item ${error.reviews >= 1 ? 'review-completed' : 'review-pending'}">
                                1å¤©å¾Œ
                            </div>
                            <div class="review-item ${error.reviews >= 2 ? 'review-completed' : 'review-pending'}">
                                3å¤©å¾Œ
                            </div>
                            <div class="review-item ${error.reviews >= 3 ? 'review-completed' : 'review-pending'}">
                                7å¤©å¾Œ
                            </div>
                        </div>
                        <div style="margin-top: 10px; display: flex; gap: 10px;">
                            <button class="btn" onclick="reviewError(${error.id})" style="flex: 1; padding: 8px; cursor: pointer;">è¤‡ç¿’</button>
                            <button class="btn btn-success" onclick="markMastered(${error.id})" style="flex: 1; padding: 8px; cursor: pointer;">å·²æŒæ¡</button>
                            <button class="btn btn-danger" onclick="deleteError(${error.id})" style="flex: 1; padding: 8px; cursor: pointer;">åˆªé™¤</button>
                        </div>
                    </div>
                `;
            });
            
            content.innerHTML = html;
        }

        function getSubjectName(subject) {
            const names = {
                math: 'æ•¸å­¸',
                english: 'è‹±èª',
                physics: 'ç‰©ç†',
                chemistry: 'åŒ–å­¸',
                other: 'å…¶ä»–'
            };
            return names[subject] || 'å…¶ä»–';
        }

        function reviewError(id) {
            const error = errors.find(e => e.id === id);
            if (!error) {
                alert('æ‰¾ä¸åˆ°è©²éŒ¯é¡Œï¼');
                return;
            }
            
            // æª¢æŸ¥ç•¶å‰æ˜¯å¦åœ¨è¤‡ç¿’é é¢
            const reviewTab = document.getElementById('errorReviewTab');
            const listTab = document.getElementById('errorListTab');
            
            let targetContainer;
            if (reviewTab && reviewTab.style.display !== 'none') {
                targetContainer = document.getElementById('reviewContent');
            } else if (listTab && listTab.style.display !== 'none') {
                targetContainer = document.getElementById('errorListContent');
            } else {
                // åˆ‡æ›åˆ°éŒ¯é¡Œåˆ—è¡¨é é¢
                switchErrorTab('list');
                targetContainer = document.getElementById('errorListContent');
            }
            
            // é¡¯ç¤ºè¤‡ç¿’ä»‹é¢
            targetContainer.innerHTML = `
                <div class="error-item">
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                        <h3>ğŸ“– è¤‡ç¿’éŒ¯é¡Œ</h3>
                        <p><strong>ç§‘ç›®ï¼š</strong>${getSubjectName(error.subject)} - ${error.chapter || 'æœªåˆ†é¡'}</p>
                        <p><strong>é›£åº¦ï¼š</strong>${'â­'.repeat(error.difficulty)}</p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 15px 0;">
                        <h4>é¡Œç›®ï¼š</h4>
                        <p style="margin: 10px 0; line-height: 1.5;">${error.question}</p>
                    </div>
                    
                    <div class="input-group">
                        <label>è«‹è¼¸å…¥ç­”æ¡ˆï¼š</label>
                        <input type="text" id="reviewAnswer" placeholder="è¼¸å…¥ä½ çš„ç­”æ¡ˆ" style="margin: 10px 0;" onkeypress="if(event.key==='Enter') checkReviewAnswer(${id})">
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin: 15px 0;">
                        <button class="btn" onclick="checkReviewAnswer(${id})" style="flex: 1;">æäº¤ç­”æ¡ˆ</button>
                        <button class="btn btn-secondary" onclick="showReviewAnswer(${id})" style="flex: 1;">é¡¯ç¤ºç­”æ¡ˆ</button>
                    </div>
                    
                    <button class="btn" onclick="goBackToErrorList()" style="background: #6c757d; margin-top: 10px;">è¿”å›åˆ—è¡¨</button>
                </div>
            `;
            
            // èšç„¦åˆ°è¼¸å…¥æ¡†
            setTimeout(() => {
                const answerInput = document.getElementById('reviewAnswer');
                if (answerInput) {
                    answerInput.focus();
                }
            }, 100);
        }

        function goBackToErrorList() {
            // æª¢æŸ¥ç•¶å‰åœ¨å“ªå€‹é é¢ä¸¦è¿”å›ç›¸æ‡‰åˆ—è¡¨
            const reviewTab = document.getElementById('errorReviewTab');
            if (reviewTab && reviewTab.style.display !== 'none') {
                updateReviewContent();
            } else {
                showErrorList();
            }
        }

        function checkReviewAnswer(id) {
            const error = errors.find(e => e.id === id);
            const userAnswerElement = document.getElementById('reviewAnswer');
            
            if (!userAnswerElement) {
                alert('è«‹è¼¸å…¥ç­”æ¡ˆï¼');
                return;
            }
            
            const userAnswer = userAnswerElement.value.trim();
            if (!userAnswer) {
                alert('è«‹è¼¸å…¥ç­”æ¡ˆï¼');
                return;
            }
            
            const isCorrect = userAnswer.toLowerCase() === error.correctAnswer.toLowerCase();
            
            if (isCorrect) {
                error.reviews++;
                error.reviewDates.push(new Date().toISOString());
                error.nextReviewDate = getNextReviewDate(error.reviews);
                
                if (error.reviews >= 5) {
                    error.mastered = true;
                }
                
                localStorage.setItem('errors', JSON.stringify(errors));
                updateErrorStats();
                playSound('correct');
                
                alert('âœ… æ­£ç¢ºï¼ç¹¼çºŒåŠ æ²¹ï¼');
            } else {
                playSound('error');
                alert(`âŒ éŒ¯èª¤ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${error.correctAnswer}`);
            }
            
            goBackToErrorList();
        }

        function showReviewAnswer(id) {
            const error = errors.find(e => e.id === id);
            const answerInfo = `æ­£ç¢ºç­”æ¡ˆï¼š${error.correctAnswer}\n\nè§£é¡Œæ­¥é©Ÿï¼š\n${error.solution || 'æœªæä¾›'}`;
            alert(answerInfo);
        }

        function markMastered(id) {
            try {
                const error = errors.find(e => e.id === id);
                if (error) {
                    error.mastered = true;
                    localStorage.setItem('errors', JSON.stringify(errors));
                    updateErrorStats();
                    showErrorList();
                    alert('å·²æ¨™è¨˜ç‚ºæŒæ¡ï¼');
                } else {
                    alert('æ‰¾ä¸åˆ°è©²éŒ¯é¡Œï¼');
                }
            } catch (error) {
                console.error('æ¨™è¨˜æŒæ¡æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                alert('æ“ä½œå¤±æ•—ï¼Œè«‹é‡è©¦ï¼');
            }
        }

        function deleteError(id) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹éŒ¯é¡Œå—ï¼Ÿ')) {
                errors = errors.filter(e => e.id !== id);
                localStorage.setItem('errors', JSON.stringify(errors));
                updateErrorStats();
                showErrorList();
            }
        }

        function filterErrors(subject) {
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // ç¯©é¸éŒ¯é¡Œ
            let filteredErrors = subject === 'all' ? errors : errors.filter(e => e.subject === subject);
            
            // é¡¯ç¤ºç¯©é¸å¾Œçš„éŒ¯é¡Œ
            const content = document.getElementById('errorListContent');
            if (filteredErrors.length === 0) {
                content.innerHTML = '<p style="text-align: center; color: #666; margin: 20px 0;">æ²’æœ‰ç›¸é—œéŒ¯é¡Œ</p>';
                return;
            }
            
            // é‡æ–°æ¸²æŸ“éŒ¯é¡Œåˆ—è¡¨ï¼ˆé€™è£¡å¯ä»¥é‡ç”¨showErrorListçš„é‚è¼¯ï¼‰
            showErrorList();
        }

        function showErrorAnalysis() {
            const content = document.getElementById('analysisContent');
            
            if (errors.length === 0) {
                content.innerHTML = '<p style="text-align: center; color: #666; margin: 20px 0;">é‚„æ²’æœ‰è¶³å¤ çš„æ•¸æ“šé€²è¡Œåˆ†æ</p>';
                return;
            }
            
            // æŒ‰ç§‘ç›®çµ±è¨ˆ
            const subjectStats = {};
            errors.forEach(error => {
                if (!subjectStats[error.subject]) {
                    subjectStats[error.subject] = {
                        total: 0,
                        mastered: 0,
                        avgDifficulty: 0
                    };
                }
                subjectStats[error.subject].total++;
                if (error.mastered) subjectStats[error.subject].mastered++;
                subjectStats[error.subject].avgDifficulty += error.difficulty;
            });
            
            let html = '<h3>ğŸ“Š å¼±é»åˆ†æå ±å‘Š</h3>';
            
            // ç§‘ç›®åˆ†æ
            html += '<h4>å„ç§‘éŒ¯é¡Œåˆ†å¸ƒ</h4>';
            html += '<div style="margin: 15px 0;">';
            
            Object.keys(subjectStats).forEach(subject => {
                const stats = subjectStats[subject];
                const masteryRate = Math.round((stats.mastered / stats.total) * 100);
                const avgDiff = (stats.avgDifficulty / stats.total).toFixed(1);
                
                html += `
                    <div style="background: #f8f9fa; padding: 10px; margin: 5px 0; border-radius: 5px;">
                        <strong>${getSubjectName(subject)}</strong>
                        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                            <span>éŒ¯é¡Œæ•¸ï¼š${stats.total}</span>
                            <span>æŒæ¡ç‡ï¼š${masteryRate}%</span>
                            <span>å¹³å‡é›£åº¦ï¼š${'â­'.repeat(Math.round(avgDiff))}</span>
                        </div>
                        <div class="progress-bar" style="margin-top: 5px;">
                            <div class="progress-fill" style="width: ${masteryRate}%"></div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            // è¤‡ç¿’å»ºè­°
            html += '<h4>ğŸ’¡ å­¸ç¿’å»ºè­°</h4>';
            html += '<ul style="padding-left: 20px;">';
            
            // æ‰¾å‡ºæœ€éœ€è¦åŠ å¼·çš„ç§‘ç›®
            let weakestSubject = null;
            let lowestMasteryRate = 100;
            
            Object.keys(subjectStats).forEach(subject => {
                const masteryRate = (subjectStats[subject].mastered / subjectStats[subject].total) * 100;
                if (masteryRate < lowestMasteryRate) {
                    lowestMasteryRate = masteryRate;
                    weakestSubject = subject;
                }
            });
            
            if (weakestSubject) {
                html += `<li>å»ºè­°å„ªå…ˆè¤‡ç¿’<strong>${getSubjectName(weakestSubject)}</strong>ï¼Œç›®å‰æŒæ¡ç‡è¼ƒä½</li>`;
            }
            
            // çµ±è¨ˆå¾…è¤‡ç¿’çš„éŒ¯é¡Œ
            const overdueErrors = errors.filter(e => {
                if (e.mastered || !e.nextReviewDate) return false;
                return new Date(e.nextReviewDate) < new Date();
            });
            
            if (overdueErrors.length > 0) {
                html += `<li>æœ‰ <strong>${overdueErrors.length}</strong> é“éŒ¯é¡Œéœ€è¦è¤‡ç¿’</li>`;
            }
            
            html += '<li>å»ºè­°æ¯å¤©è‡³å°‘è¤‡ç¿’ 3-5 é“éŒ¯é¡Œï¼Œä¿æŒè¨˜æ†¶</li>';
            html += '<li>å°æ–¼é«˜é›£åº¦é¡Œç›®ï¼Œå¯ä»¥å¤šåšé¡ä¼¼é¡Œå‹åŠ å¼·ç·´ç¿’</li>';
            html += '</ul>';
            
            content.innerHTML = html;
        }

        function exportErrors() {
            if (errors.length === 0) {
                alert('æ²’æœ‰éŒ¯é¡Œå¯ä»¥åŒ¯å‡ºï¼');
                return;
            }
            
            let csvContent = 'ç§‘ç›®,ç« ç¯€,é¡Œç›®,æˆ‘çš„ç­”æ¡ˆ,æ­£ç¢ºç­”æ¡ˆ,è§£é¡Œæ­¥é©Ÿ,éŒ¯èª¤åŸå› ,é›£åº¦,å»ºç«‹æ—¥æœŸ,è¤‡ç¿’æ¬¡æ•¸\n';
            
            errors.forEach(error => {
                const row = [
                    getSubjectName(error.subject),
                    error.chapter || '',
                    `"${error.question.replace(/"/g, '""')}"`,
                    error.myAnswer || '',
                    error.correctAnswer,
                    `"${(error.solution || '').replace(/"/g, '""')}"`,
                    `"${(error.reason || '').replace(/"/g, '""')}"`,
                    error.difficulty,
                    new Date(error.createDate).toLocaleDateString('zh-TW'),
                    error.reviews
                ].join(',');
                
                csvContent += row + '\n';
            });
            
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'éŒ¯é¡Œæœ¬_' + new Date().toLocaleDateString('zh-TW') + '.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function clearAllErrors() {
            if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰éŒ¯é¡Œå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
                errors = [];
                localStorage.setItem('errors', JSON.stringify(errors));
                updateErrorStats();
                showErrorList();
            }
        }

        function updateReviewContent() {
            const content = document.getElementById('reviewContent');
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const todayErrors = errors.filter(e => {
                if (e.mastered || !e.nextReviewDate) return false;
                const reviewDate = new Date(e.nextReviewDate);
                reviewDate.setHours(0, 0, 0, 0);
                return reviewDate.getTime() === today.getTime();
            });
            
            const overdueErrors = errors.filter(e => {
                if (e.mastered || !e.nextReviewDate) return false;
                return new Date(e.nextReviewDate) < today;
            });
            
            if (todayErrors.length === 0 && overdueErrors.length === 0) {
                content.innerHTML = '<p style="text-align: center; color: #666; margin: 20px 0;">ğŸ‰ ä»Šå¤©æ²’æœ‰éœ€è¦è¤‡ç¿’çš„éŒ¯é¡Œï¼</p>';
                return;
            }
            
            let html = '';
            
            if (overdueErrors.length > 0) {
                html += `<h4 style="color: #dc3545;">âš ï¸ é€¾æœŸæœªè¤‡ç¿’ (${overdueErrors.length})</h4>`;
                overdueErrors.forEach(error => {
                    html += createReviewCard(error);
                });
            }
            
            if (todayErrors.length > 0) {
                html += `<h4 style="color: #28a745;">ğŸ“… ä»Šæ—¥è¤‡ç¿’ (${todayErrors.length})</h4>`;
                todayErrors.forEach(error => {
                    html += createReviewCard(error);
                });
            }
            
            content.innerHTML = html;
        }

        function createReviewCard(error) {
            const daysSinceCreated = Math.floor((new Date() - new Date(error.createDate)) / (1000 * 60 * 60 * 24));
            
            return `
                <div class="error-item">
                    <div class="error-item-header">
                        <span class="subject-tag subject-${error.subject}">${getSubjectName(error.subject)}</span>
                        <span style="font-size: 0.85em; color: #666;">å»ºç«‹æ–¼ ${daysSinceCreated} å¤©å‰</span>
                    </div>
                    <p><strong>${error.chapter || 'æœªåˆ†é¡'}</strong></p>
                    <p style="color: #666; font-size: 0.9em;">å·²è¤‡ç¿’ ${error.reviews} æ¬¡</p>
                    <button class="btn" onclick="reviewError(${error.id})" style="margin-top: 10px; width: 100%;">é–‹å§‹è¤‡ç¿’</button>
                </div>
            `;
        }

        function filterReview(type) {
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // æ ¹æ“šé¡å‹æ›´æ–°å…§å®¹
            if (type === 'all' || type === 'today' || type === 'overdue') {
                updateReviewContent();
            } else if (type === 'subject') {
                // æŒ‰ç§‘ç›®é¡¯ç¤ºå¾…è¤‡ç¿’çš„éŒ¯é¡Œ
                showReviewBySubject();
            }
        }

        function showReviewBySubject() {
            const content = document.getElementById('reviewContent');
            const pendingReviews = errors.filter(e => !e.mastered && e.nextReviewDate);
            
            if (pendingReviews.length === 0) {
                content.innerHTML = '<p style="text-align: center; color: #666; margin: 20px 0;">æ²’æœ‰å¾…è¤‡ç¿’çš„éŒ¯é¡Œ</p>';
                return;
            }
            
            // æŒ‰ç§‘ç›®åˆ†çµ„
            const bySubject = {};
            pendingReviews.forEach(error => {
                if (!bySubject[error.subject]) {
                    bySubject[error.subject] = [];
                }
                bySubject[error.subject].push(error);
            });
            
            let html = '';
            Object.keys(bySubject).forEach(subject => {
                html += `<h4>${getSubjectName(subject)} (${bySubject[subject].length})</h4>`;
                bySubject[subject].forEach(error => {
                    html += createReviewCard(error);
                });
            });
            
            content.innerHTML = html;
        }

        // éŸ³æ•ˆåŠŸèƒ½
        function playSound(type) {
            if (!document.getElementById('soundEnabled') || !document.getElementById('soundEnabled').checked) return;
            
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                let frequency, duration;
                
                if (type === 'correct') {
                    // æ­£ç¢ºéŸ³æ•ˆï¼šæ„‰å¿«çš„ä¸Šå‡éŸ³èª¿
                    frequency = 800;
                    duration = 0.3;
                } else {
                    // éŒ¯èª¤éŸ³æ•ˆï¼šä½æ²‰çš„ä¸‹é™éŸ³èª¿
                    frequency = 300;
                    duration = 0.5;
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                if (type === 'correct') {
                    oscillator.frequency.exponentialRampToValueAtTime(frequency * 1.5, audioContext.currentTime + duration);
                } else {
                    oscillator.frequency.exponentialRampToValueAtTime(frequency * 0.5, audioContext.currentTime + duration);
                }
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            } catch (error) {
                console.log('éŸ³æ•ˆæ’­æ”¾å¤±æ•—:', error);
            }
        }

        // é¡¯ç¤ºå·¥å…·
        function showTool(toolName) {
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById(toolName).style.display = 'block';
            
            // å¦‚æœæ˜¯éŒ¯é¡Œæœ¬ï¼Œæ›´æ–°çµ±è¨ˆ
            if (toolName === 'errors') {
                updateErrorStats();
            }
        }

        // è¿”å›ä¸»é¸å–®
        function showMain() {
            document.querySelectorAll('.learning-area').forEach(area => {
                area.style.display = 'none';
            });
            document.getElementById('mainMenu').style.display = 'grid';
        }

        // å–®å­—è¨˜æ†¶åŠŸèƒ½
        function addWord() {
            const word = document.getElementById('newWord').value.trim();
            const meaning = document.getElementById('wordMeaning').value.trim();
            const example = document.getElementById('wordExample').value.trim();
            
            if (word && meaning) {
                vocabulary.push({
                    word, 
                    meaning, 
                    example,
                    learned: false, 
                    mastery: 0,
                    addedDate: new Date().toISOString(),
                    reviewCount: 0,
                    nextReviewDate: getNextReviewDate(0)
                });
                localStorage.setItem('vocabulary', JSON.stringify(vocabulary));
                updateWordCount();
                updateLearningProgress();
                document.getElementById('newWord').value = '';
                document.getElementById('wordMeaning').value = '';
                document.getElementById('wordExample').value = '';
                alert('å–®å­—å·²æ–°å¢ï¼');
            }
        }

        // æ‰¹é‡åŒ¯å…¥å–®å­—
        function importWords() {
            const importText = document.getElementById('importWords').value.trim();
            if (!importText) {
                alert('è«‹è¼¸å…¥è¦åŒ¯å…¥çš„å–®å­—ï¼');
                return;
            }
            
            const lines = importText.split('\n');
            let successCount = 0;
            let errorLines = [];
            
            lines.forEach((line, index) => {
                const trimmedLine = line.trim();
                if (trimmedLine) {
                    const parts = trimmedLine.split(',');
                    if (parts.length >= 2) {
                        const word = parts[0].trim();
                        const meaning = parts[1].trim();
                        const example = parts.length >= 3 ? parts.slice(2).join(',').trim() : ''; // è™•ç†ä¾‹å¥ä¸­å¯èƒ½æœ‰é€—è™Ÿ
                        
                        if (word && meaning) {
                            vocabulary.push({
                                word,
                                meaning,
                                example,
                                learned: false,
                                addedDate: new Date().toISOString(),
                                reviewDates: [],
                                reviewCount: 0,
                                nextReviewDate: getNextReviewDate(0),
                                mastery: 0
                            });
                            successCount++;
                        } else {
                            errorLines.push(index + 1);
                        }
                    } else {
                        errorLines.push(index + 1);
                    }
                }
            });
            
            localStorage.setItem('vocabulary', JSON.stringify(vocabulary));
            updateWordCount();
            updateLearningProgress();
            document.getElementById('importWords').value = '';
            
            let message = `æˆåŠŸåŒ¯å…¥ ${successCount} å€‹å–®å­—ï¼`;
            if (errorLines.length > 0) {
                message += `\nç¬¬ ${errorLines.join(', ')} è¡Œæ ¼å¼éŒ¯èª¤ï¼Œå·²è·³éã€‚`;
            }
            message += '\n\næç¤ºï¼šå¯ä½¿ç”¨æ ¼å¼ã€Œè‹±æ–‡,ä¸­æ–‡,ä¾‹å¥ã€ä¾†åŒ…å«ä¾‹å¥ã€‚';
            alert(message);
        }

        // è™•ç†æª”æ¡ˆä¸Šå‚³
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                document.getElementById('importWords').value = content;
                alert('æª”æ¡ˆå…§å®¹å·²è¼‰å…¥ï¼Œé»æ“Šã€ŒåŒ¯å…¥å–®å­—ã€æŒ‰éˆ•å®ŒæˆåŒ¯å…¥ï¼');
            };
            reader.readAsText(file, 'UTF-8');
        }

        // é¡¯ç¤ºæ‰€æœ‰å–®å­—
        function showAllWords() {
            if (vocabulary.length === 0) {
                document.getElementById('wordDisplay').innerHTML = '<p>é‚„æ²’æœ‰ä»»ä½•å–®å­—</p>';
                return;
            }
            
            // æŒ‰ä¸»é¡Œåˆ†çµ„
            const wordsByTheme = {};
            const noThemeWords = [];
            
            vocabulary.forEach((item, index) => {
                item.index = index; // ä¿å­˜ç´¢å¼•ä»¥ä¾¿åˆªé™¤
                if (item.theme && curriculum108[item.theme]) {
                    if (!wordsByTheme[item.theme]) {
                        wordsByTheme[item.theme] = [];
                    }
                    wordsByTheme[item.theme].push(item);
                } else {
                    noThemeWords.push(item);
                }
            });
            
            let html = '<h3>æ‰€æœ‰å–®å­—åˆ—è¡¨ï¼š</h3><div style="max-height: 400px; overflow-y: auto;">';
            
            // é¡¯ç¤º108èª²ç¶±åˆ†é¡å–®å­—
            Object.keys(wordsByTheme).forEach(theme => {
                const themeName = curriculum108[theme].name;
                html += `<h4 style="color: #1976d2; margin-top: 15px;">ğŸ“š ${themeName}</h4>`;
                
                wordsByTheme[theme].forEach(item => {
                    const masteryColor = item.mastery >= 80 ? '#4caf50' : item.mastery >= 50 ? '#ff9800' : '#f44336';
                    html += `
                        <div style="border: 1px solid #ddd; padding: 10px; margin: 5px 0; border-radius: 5px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="flex: 1;">
                                    <strong>${item.word}</strong> - ${item.meaning}
                                    ${item.example ? `<div style="color: #666; font-size: 0.9em; margin-top: 5px;">ä¾‹å¥ï¼š${item.example}</div>` : ''}
                                    <div style="display: flex; align-items: center; margin-top: 5px;">
                                        <span style="font-size: 0.85em; color: #666;">æŒæ¡åº¦ï¼š</span>
                                        <div style="width: 100px; height: 10px; background: #e0e0e0; border-radius: 5px; margin: 0 10px;">
                                            <div style="width: ${item.mastery || 0}%; height: 100%; background: ${masteryColor}; border-radius: 5px;"></div>
                                        </div>
                                        <span style="font-size: 0.85em; color: ${masteryColor};">${item.mastery || 0}%</span>
                                    </div>
                                </div>
                                <button onclick="deleteWord(${item.index})" style="background: #ff6b6b; color: white; border: none; padding: 5px 10px; border-radius: 3px; font-size: 12px;">åˆªé™¤</button>
                            </div>
                        </div>
                    `;
                });
            });
            
            // é¡¯ç¤ºè‡ªè¨‚å–®å­—
            if (noThemeWords.length > 0) {
                html += `<h4 style="color: #666; margin-top: 15px;">ğŸ“ è‡ªè¨‚å–®å­—</h4>`;
                noThemeWords.forEach(item => {
                    const masteryColor = item.mastery >= 80 ? '#4caf50' : item.mastery >= 50 ? '#ff9800' : '#f44336';
                    html += `
                        <div style="border: 1px solid #ddd; padding: 10px; margin: 5px 0; border-radius: 5px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="flex: 1;">
                                    <strong>${item.word}</strong> - ${item.meaning}
                                    ${item.example ? `<div style="color: #666; font-size: 0.9em; margin-top: 5px;">ä¾‹å¥ï¼š${item.example}</div>` : ''}
                                    <div style="display: flex; align-items: center; margin-top: 5px;">
                                        <span style="font-size: 0.85em; color: #666;">æŒæ¡åº¦ï¼š</span>
                                        <div style="width: 100px; height: 10px; background: #e0e0e0; border-radius: 5px; margin: 0 10px;">
                                            <div style="width: ${item.mastery || 0}%; height: 100%; background: ${masteryColor}; border-radius: 5px;"></div>
                                        </div>
                                        <span style="font-size: 0.85em; color: ${masteryColor};">${item.mastery || 0}%</span>
                                    </div>
                                </div>
                                <button onclick="deleteWord(${item.index})" style="background: #ff6b6b; color: white; border: none; padding: 5px 10px; border-radius: 3px; font-size: 12px;">åˆªé™¤</button>
                            </div>
                        </div>
                    `;
                });
            }
            
            html += '</div>';
            document.getElementById('wordDisplay').innerHTML = html;
        }
        
        // åˆªé™¤å–®å­—
        function deleteWord(index) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹å–®å­—å—ï¼Ÿ')) {
                vocabulary.splice(index, 1);
                localStorage.setItem('vocabulary', JSON.stringify(vocabulary));
                updateWordCount();
                updateLearningProgress();
                showAllWords();
            }
        }

        // åŒ¯å‡ºå–®å­—
        function exportWords() {
            if (vocabulary.length === 0) {
                alert('æ²’æœ‰å–®å­—å¯ä»¥åŒ¯å‡ºï¼');
                return;
            }
            
            let csvContent = '\ufeff'; // BOM for UTF-8
            csvContent += 'è‹±æ–‡å–®å­—,ä¸­æ–‡æ„æ€,ä¾‹å¥,æŒæ¡ç¨‹åº¦,ä¸»é¡Œ,å¹´ç´š\n';
            
            vocabulary.forEach(item => {
                const example = item.example ? `"${item.example.replace(/"/g, '""')}"` : '';
                const theme = item.theme ? curriculum108[item.theme]?.name || '' : '';
                const grade = item.grade ? `${item.grade}å¹´ç´š` : '';
                
                csvContent += `${item.word},${item.meaning},${example},${item.mastery || 0}%,${theme},${grade}\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `æˆ‘çš„å–®å­—åº«_${new Date().toLocaleDateString('zh-TW')}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function startWordTest() {
            if (vocabulary.length === 0) {
                alert('è«‹å…ˆæ–°å¢ä¸€äº›å–®å­—ï¼');
                return;
            }
            
            const randomWord = vocabulary[Math.floor(Math.random() * vocabulary.length)];
            currentWordTest = randomWord;
            
            document.getElementById('wordDisplay').innerHTML = `
                <h3>è«‹å¯«å‡ºä»¥ä¸‹å–®å­—çš„ä¸­æ–‡æ„æ€ï¼š</h3>
                <p style="font-size: 1.5em; color: #667eea; font-weight: bold;">${randomWord.word}</p>
                <input type="text" id="wordTestAnswer" placeholder="è¼¸å…¥ä¸­æ–‡æ„æ€">
                <button class="btn" onclick="checkWordAnswer()">æª¢æŸ¥ç­”æ¡ˆ</button>
            `;
            
            document.getElementById('wordTestAnswer').focus();
        }

        function checkWordAnswer() {
            const userAnswer = document.getElementById('wordTestAnswer').value.trim();
            const correct = userAnswer === currentWordTest.meaning;
            
            // æ›´æ–°å­¸ç¿’è¨˜éŒ„
            if (!currentWordTest.learned) {
                currentWordTest.learned = true;
            }
            
            if (correct) {
                currentWordTest.mastery = Math.min(100, (currentWordTest.mastery || 0) + 10);
                playSound('correct');
            } else {
                currentWordTest.mastery = Math.max(0, (currentWordTest.mastery || 0) - 5);
                playSound('error');
            }
            
            localStorage.setItem('vocabulary', JSON.stringify(vocabulary));
            updateLearningProgress();
            
            document.getElementById('wordDisplay').innerHTML = `
                <h3>${correct ? 'âœ… æ­£ç¢ºï¼' : 'âŒ éŒ¯èª¤'}</h3>
                <p><strong>${currentWordTest.word}</strong> = ${currentWordTest.meaning}</p>
                <p>ä½ çš„ç­”æ¡ˆï¼š${userAnswer}</p>
                ${currentWordTest.example ? `<p style="margin-top: 10px; font-style: italic;">"${currentWordTest.example}"</p>` : ''}
                <button class="btn" onclick="startWordTest()">ä¸‹ä¸€é¡Œ</button>
            `;
        }

        // æ•¸å­¸ç·´ç¿’åŠŸèƒ½
        function startMathPractice() {
            generateMathQuestion();
            document.getElementById('mathAnswer').style.display = 'block';
            document.getElementById('submitMath').style.display = 'block';
            document.getElementById('mathAnswer').focus();
        }

        function generateMathQuestion() {
            const level = document.getElementById('mathLevel').value;
            const type = document.getElementById('mathType').value;
            
            let max = level === 'easy' ? 10 : level === 'medium' ? 50 : 100;
            let operations = type === 'mix' ? ['add', 'sub', 'mul'] : [type];
            let operation = operations[Math.floor(Math.random() * operations.length)];
            
            let a = Math.floor(Math.random() * max) + 1;
            let b = Math.floor(Math.random() * max) + 1;
            let answer, symbol;
            
            switch(operation) {
                case 'add':
                    answer = a + b;
                    symbol = '+';
                    break;
                case 'sub':
                    if (a < b) [a, b] = [b, a]; // ç¢ºä¿çµæœç‚ºæ­£æ•¸
                    answer = a - b;
                    symbol = '-';
                    break;
                case 'mul':
                    if (level === 'easy') {
                        a = Math.floor(Math.random() * 10) + 1;
                        b = Math.floor(Math.random() * 10) + 1;
                    }
                    answer = a * b;
                    symbol = 'Ã—';
                    break;
            }
            
            currentMathQuestion = {a, b, answer, symbol};
            document.getElementById('mathQuestion').innerHTML = `
                <h3>${a} ${symbol} ${b} = ?</h3>
            `;
            document.getElementById('mathAnswer').value = '';
        }

        function checkMathAnswer() {
            const userAnswer = parseInt(document.getElementById('mathAnswer').value);
            const correct = userAnswer === currentMathQuestion.answer;
            
            mathScore.total++;
            if (correct) mathScore.correct++;
            
            document.getElementById('correctCount').textContent = mathScore.correct;
            document.getElementById('totalCount').textContent = mathScore.total;
            
            document.getElementById('mathQuestion').innerHTML = `
                <h3>${correct ? 'âœ… æ­£ç¢ºï¼' : 'âŒ éŒ¯èª¤'}</h3>
                <p>${currentMathQuestion.a} ${currentMathQuestion.symbol} ${currentMathQuestion.b} = ${currentMathQuestion.answer}</p>
                <button class="btn" onclick="generateMathQuestion(); document.getElementById('mathAnswer').focus();">ä¸‹ä¸€é¡Œ</button>
            `;
        }

        // è¨ˆæ™‚å™¨åŠŸèƒ½
        function startTimer() {
            if (!timerRunning) {
                const minutes = parseInt(document.getElementById('timerMinutes').value);
                timerSeconds = minutes * 60;
                timerRunning = true;
                
                timerInterval = setInterval(() => {
                    if (timerSeconds > 0) {
                        timerSeconds--;
                        updateTimerDisplay();
                    } else {
                        timerComplete();
                    }
                }, 1000);
                
                document.getElementById('timerStatus').textContent = 'å°ˆæ³¨å­¸ç¿’ä¸­...';
            }
        }

        function pauseTimer() {
            if (timerRunning) {
                clearInterval(timerInterval);
                timerRunning = false;
                document.getElementById('timerStatus').textContent = 'å·²æš«åœ';
            } else if (timerSeconds > 0) {
                startTimer();
            }
        }

        function resetTimer() {
            clearInterval(timerInterval);
            timerRunning = false;
            const minutes = parseInt(document.getElementById('timerMinutes').value);
            timerSeconds = minutes * 60;
            updateTimerDisplay();
            document.getElementById('timerStatus').textContent = 'æº–å‚™é–‹å§‹å°ˆæ³¨å­¸ç¿’ï¼';
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            document.getElementById('timerDisplay').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            const totalMinutes = parseInt(document.getElementById('timerMinutes').value);
            const progress = ((totalMinutes * 60 - timerSeconds) / (totalMinutes * 60)) * 100;
            document.getElementById('timerProgress').style.width = progress + '%';
        }

        function timerComplete() {
            clearInterval(timerInterval);
            timerRunning = false;
            document.getElementById('timerStatus').innerHTML = 'ğŸ‰ æ™‚é–“åˆ°ï¼ä¼‘æ¯ä¸€ä¸‹å§ï¼';
            try {
                if ('Notification' in window && Notification.permission === 'granted') {
                    new Notification('å°ˆæ³¨æ™‚é–“çµæŸï¼', {body: 'è©²ä¼‘æ¯ä¸€ä¸‹äº†ï¼'});
                }
            } catch (error) {
                console.log('é€šçŸ¥å¤±æ•—:', error);
            }
        }

        // ç­†è¨˜åŠŸèƒ½
        function saveNote() {
            const title = document.getElementById('noteTitle').value.trim();
            const content = document.getElementById('noteContent').value.trim();
            
            if (title && content) {
                notes.push({
                    title,
                    content,
                    date: new Date().toLocaleString('zh-TW')
                });
                localStorage.setItem('notes', JSON.stringify(notes));
                document.getElementById('noteTitle').value = '';
                document.getElementById('noteContent').value = '';
                alert('ç­†è¨˜å·²å„²å­˜ï¼');
            }
        }

        function showNotes() {
            if (notes.length === 0) {
                document.getElementById('notesResult').innerHTML = '<p>é‚„æ²’æœ‰ä»»ä½•ç­†è¨˜</p>';
                return;
            }
            
            let html = '<h3>æ‰€æœ‰ç­†è¨˜ï¼š</h3><div style="max-height: 400px; overflow-y: auto;">';
            notes.forEach((note, index) => {
                html += `
                    <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px; background: #fafafa;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                            <h4 style="margin: 0; color: #333;">${note.title}</h4>
                            <button onclick="deleteNote(${index})" style="background: #ff6b6b; color: white; border: none; padding: 5px 10px; border-radius: 3px; font-size: 12px;">åˆªé™¤</button>
                        </div>
                        <div style="background: white; padding: 10px; border-radius: 5px; margin: 10px 0;">
                            <p style="margin: 0; white-space: pre-wrap;">${note.content}</p>
                        </div>
                        <small style="color: #666;">å»ºç«‹æ™‚é–“ï¼š${note.date}</small>
                    </div>
                `;
            });
            html += '</div>';
            document.getElementById('notesResult').innerHTML = html;
        }

        function deleteNote(index) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹ç­†è¨˜å—ï¼Ÿ')) {
                notes.splice(index, 1);
                localStorage.setItem('notes', JSON.stringify(notes));
                showNotes();
                alert('ç­†è¨˜å·²åˆªé™¤ï¼');
            }
        }

        function exportNotes() {
            if (notes.length === 0) {
                alert('æ²’æœ‰ç­†è¨˜å¯ä»¥åŒ¯å‡ºï¼');
                return;
            }
            
            let txtContent = 'æˆ‘çš„å­¸ç¿’ç­†è¨˜\n';
            txtContent += '==================\n\n';
            
            notes.forEach((note, index) => {
                txtContent += `${index + 1}. ${note.title}\n`;
                txtContent += `å»ºç«‹æ™‚é–“ï¼š${note.date}\n`;
                txtContent += 'å…§å®¹ï¼š\n';
                txtContent += note.content + '\n\n';
                txtContent += '-------------------\n\n';
            });
            
            const blob = new Blob([txtContent], { type: 'text/plain;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `å­¸ç¿’ç­†è¨˜_${new Date().toLocaleDateString('zh-TW')}.txt`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // å•ç­”åŠŸèƒ½
        function addQuestion() {
            const question = document.getElementById('newQuestion').value.trim();
            const answer = document.getElementById('questionAnswer').value.trim();
            
            if (question && answer) {
                questions.push({question, answer});
                localStorage.setItem('questions', JSON.stringify(questions));
                document.getElementById('questionCount').textContent = questions.length;
                document.getElementById('newQuestion').value = '';
                document.getElementById('questionAnswer').value = '';
                alert('å•é¡Œå·²æ–°å¢ï¼');
            }
        }

        function startQuiz() {
            if (questions.length === 0) {
                alert('è«‹å…ˆæ–°å¢ä¸€äº›å•é¡Œï¼');
                return;
            }
            
            const randomQuestion = questions[Math.floor(Math.random() * questions.length)];
            currentQuiz = randomQuestion;
            
            document.getElementById('quizDisplay').innerHTML = `
                <h3>å•é¡Œï¼š</h3>
                <p style="font-size: 1.2em; color: #667eea;">${randomQuestion.question}</p>
                <input type="text" id="quizAnswer" placeholder="è¼¸å…¥ç­”æ¡ˆ">
                <button class="btn" onclick="checkQuizAnswer()">æª¢æŸ¥ç­”æ¡ˆ</button>
            `;
            
            document.getElementById('quizAnswer').focus();
        }

        function checkQuizAnswer() {
            const userAnswer = document.getElementById('quizAnswer').value.trim();
            const correct = userAnswer.toLowerCase() === currentQuiz.answer.toLowerCase();
            
            document.getElementById('quizDisplay').innerHTML = `
                <h3>${correct ? 'âœ… æ­£ç¢ºï¼' : 'âŒ éŒ¯èª¤'}</h3>
                <p><strong>å•é¡Œï¼š</strong>${currentQuiz.question}</p>
                <p><strong>æ­£ç¢ºç­”æ¡ˆï¼š</strong>${currentQuiz.answer}</p>
                <p><strong>ä½ çš„ç­”æ¡ˆï¼š</strong>${userAnswer}</p>
                <button class="btn" onclick="startQuiz()">ä¸‹ä¸€é¡Œ</button>
            `;
        }

        function showAllQuestions() {
            if (questions.length === 0) {
                document.getElementById('quizDisplay').innerHTML = '<p>é‚„æ²’æœ‰ä»»ä½•å•é¡Œ</p>';
                return;
            }
            
            let html = '<h3>æ‰€æœ‰å•é¡Œåˆ—è¡¨ï¼š</h3><div style="max-height: 400px; overflow-y: auto;">';
            questions.forEach((item, index) => {
                html += `
                    <div style="border: 1px solid #ddd; padding: 10px; margin: 5px 0; border-radius: 5px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="flex: 1;">
                                <p><strong>å•é¡Œï¼š</strong>${item.question}</p>
                                <p><strong>ç­”æ¡ˆï¼š</strong>${item.answer}</p>
                            </div>
                            <button onclick="deleteQuestion(${index})" style="background: #ff6b6b; color: white; border: none; padding: 5px 10px; border-radius: 3px; font-size: 12px;">åˆªé™¤</button>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            document.getElementById('quizDisplay').innerHTML = html;
        }

        function deleteQuestion(index) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹å•é¡Œå—ï¼Ÿ')) {
                questions.splice(index, 1);
                localStorage.setItem('questions', JSON.stringify(questions));
                document.getElementById('questionCount').textContent = questions.length;
                showAllQuestions();
            }
        }

        function exportQuestions() {
            if (questions.length === 0) {
                alert('æ²’æœ‰å•é¡Œå¯ä»¥åŒ¯å‡ºï¼');
                return;
            }
            
            let csvContent = '\ufeff'; // BOM for UTF-8
            csvContent += 'å•é¡Œ,ç­”æ¡ˆ,å»ºç«‹æ—¥æœŸ\n';
            
            questions.forEach(item => {
                const question = `"${item.question.replace(/"/g, '""')}"`;
                const answer = `"${item.answer.replace(/"/g, '""')}"`;
                const date = new Date().toLocaleDateString('zh-TW');
                
                csvContent += `${question},${answer},${date}\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `å•ç­”é¡Œåº«_${new Date().toLocaleDateString('zh-TW')}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function importFromQuestions() {
            if (questions.length === 0) {
                alert('é¡Œåº«ä¸­æ²’æœ‰å•é¡Œå¯ä»¥åŒ¯å…¥ï¼è«‹å…ˆåœ¨ã€Œéš¨æ©Ÿå•ç­”ã€ä¸­æ–°å¢ä¸€äº›å•é¡Œã€‚');
                return;
            }
            
            let html = '<h3>å¾é¡Œåº«é¸æ“‡éŒ¯é¡Œ</h3>';
            html += '<p style="color: #666; margin-bottom: 15px;">é¸æ“‡æƒ³è¦åŠ å…¥éŒ¯é¡Œæœ¬çš„å•é¡Œï¼š</p>';
            html += '<div style="max-height: 300px; overflow-y: auto;">';
            
            questions.forEach((item, index) => {
                html += `
                    <div style="border: 1px solid #ddd; padding: 10px; margin: 5px 0; border-radius: 5px; cursor: pointer;" onclick="selectQuestionForError(${index})">
                        <p><strong>å•é¡Œï¼š</strong>${item.question}</p>
                        <p><strong>ç­”æ¡ˆï¼š</strong>${item.answer}</p>
                        <button class="btn" style="margin-top: 5px; padding: 5px 15px;">é¸æ“‡æ­¤é¡Œ</button>
                    </div>
                `;
            });
            
            html += '</div>';
            html += '<button class="btn btn-secondary" onclick="switchErrorTab(\'add\')" style="margin-top: 15px;">è¿”å›</button>';
            
            document.getElementById('errorAddTab').innerHTML = html;
        }

        function selectQuestionForError(questionIndex) {
            const selectedQuestion = questions[questionIndex];
            
            // é‡æ–°é¡¯ç¤ºéŒ¯é¡Œæ–°å¢è¡¨å–®
            document.getElementById('errorAddTab').innerHTML = `
                <div class="input-group">
                    <label>ç§‘ç›®ï¼š</label>
                    <select id="errorSubject">
                        <option value="math">æ•¸å­¸</option>
                        <option value="english">è‹±èª</option>
                        <option value="physics">ç‰©ç†</option>
                        <option value="chemistry">åŒ–å­¸</option>
                        <option value="other">å…¶ä»–</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>ç« ç¯€/å–®å…ƒï¼š</label>
                    <input type="text" id="errorChapter" placeholder="ä¾‹å¦‚ï¼šäºŒæ¬¡æ–¹ç¨‹å¼">
                </div>
                
                <div class="input-group">
                    <label>é¡Œç›®ï¼š</label>
                    <textarea id="errorQuestion" rows="3" placeholder="è¼¸å…¥é¡Œç›®å…§å®¹">${selectedQuestion.question}</textarea>
                </div>
                
                <div class="input-group">
                    <label>æˆ‘çš„ç­”æ¡ˆï¼ˆéŒ¯èª¤ï¼‰ï¼š</label>
                    <input type="text" id="errorMyAnswer" placeholder="è¼¸å…¥éŒ¯èª¤ç­”æ¡ˆ">
                </div>
                
                <div class="input-group">
                    <label>æ­£ç¢ºç­”æ¡ˆï¼š</label>
                    <input type="text" id="errorCorrectAnswer" placeholder="è¼¸å…¥æ­£ç¢ºç­”æ¡ˆ" value="${selectedQuestion.answer}">
                </div>
                
                <div class="input-group">
                    <label>è§£é¡Œæ­¥é©Ÿï¼š</label>
                    <textarea id="errorSolution" rows="3" placeholder="è©³ç´°è§£é¡Œéç¨‹"></textarea>
                </div>
                
                <div class="input-group">
                    <label>éŒ¯èª¤åŸå› ï¼š</label>
                    <textarea id="errorReason" rows="2" placeholder="åˆ†æéŒ¯èª¤åŸå› "></textarea>
                </div>
                
                <div class="input-group">
                    <label>é›£åº¦ï¼š</label>
                    <select id="errorDifficulty">
                        <option value="1">â­ ç°¡å–®</option>
                        <option value="2">â­â­ ä¸­ç­‰</option>
                        <option value="3">â­â­â­ å›°é›£</option>
                    </select>
                </div>
                
                <button class="btn" onclick="addError()">å„²å­˜éŒ¯é¡Œ</button>
                <button class="btn btn-secondary" onclick="clearErrorForm()">æ¸…é™¤è¡¨å–®</button>
                <button class="btn" onclick="importFromQuestions()" style="background: #17a2b8;">å¾é¡Œåº«åŒ¯å…¥</button>
            `;
            
            alert('å·²å°‡é¡Œç›®å¡«å…¥è¡¨å–®ï¼Œè«‹å®Œå–„å…¶ä»–è³‡è¨Šå¾Œå„²å­˜ï¼');
        }

        // ç›®æ¨™åŠŸèƒ½
        function addGoal() {
            const goal = document.getElementById('newGoal').value.trim();
            
            if (goal) {
                goals.push({
                    goal,
                    completed: false,
                    date: new Date().toLocaleDateString('zh-TW')
                });
                localStorage.setItem('goals', JSON.stringify(goals));
                document.getElementById('newGoal').value = '';
                alert('ç›®æ¨™å·²æ–°å¢ï¼');
            }
        }

        function showGoals() {
            if (goals.length === 0) {
                document.getElementById('goalsResult').innerHTML = '<p>é‚„æ²’æœ‰è¨­å®šä»»ä½•ç›®æ¨™</p>';
                return;
            }
            
            let html = '<h3>å­¸ç¿’ç›®æ¨™ï¼š</h3>';
            goals.forEach((goal, index) => {
                html += `
                    <div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 5px; ${goal.completed ? 'background: #e8f5e8;' : ''}">
                        <p style="${goal.completed ? 'text-decoration: line-through;' : ''}">${goal.goal}</p>
                        <small>è¨­å®šæ—¥æœŸï¼š${goal.date}</small>
                        <button onclick="toggleGoal(${index})" style="float: right; background: ${goal.completed ? '#28a745' : '#007bff'}; color: white; border: none; padding: 5px 10px; border-radius: 3px;">
                            ${goal.completed ? 'å·²å®Œæˆ' : 'æ¨™è¨˜å®Œæˆ'}
                        </button>
                    </div>
                `;
            });
            document.getElementById('goalsResult').innerHTML = html;
        }

        function toggleGoal(index) {
            goals[index].completed = !goals[index].completed;
            localStorage.setItem('goals', JSON.stringify(goals));
            showGoals();
        }

        // ä¸è¦å‰‡å‹•è©åŠŸèƒ½
        function getVerbList(level) {
            switch(level) {
                case 'basic':
                    return irregularVerbs.basic;
                case 'intermediate':
                    return irregularVerbs.intermediate;
                case 'all':
                    return [...irregularVerbs.basic, ...irregularVerbs.intermediate];
                default:
                    return irregularVerbs.basic;
            }
        }

        function startIrregularTest() {
            const level = document.getElementById('irregularLevel').value;
            const mode = document.getElementById('practiceMode').value;
            const verbList = getVerbList(level);
            
            generateIrregularQuestion(verbList, mode);
        }

        function generateIrregularQuestion(verbList, mode) {
            const randomVerb = verbList[Math.floor(Math.random() * verbList.length)];
            let question, answer, hint;
            
            switch(mode) {
                case 'past':
                    question = randomVerb.base;
                    answer = randomVerb.past;
                    hint = 'è«‹å¯«å‡ºéå»å¼';
                    break;
                case 'pp':
                    question = randomVerb.base;
                    answer = randomVerb.pp;
                    hint = 'è«‹å¯«å‡ºéå»åˆ†è©';
                    break;
                case 'base':
                    question = randomVerb.past;
                    answer = randomVerb.base;
                    hint = 'è«‹å¯«å‡ºåŸå½¢';
                    break;
                case 'mixed':
                    const modes = ['past', 'pp', 'base'];
                    const randomMode = modes[Math.floor(Math.random() * modes.length)];
                    return generateIrregularQuestion(verbList, randomMode);
            }
            
            currentIrregularTest = {
                verb: randomVerb,
                question,
                answer,
                mode
            };
            
            document.getElementById('irregularDisplay').innerHTML = `
                <div style="text-align: center; margin: 20px 0;">
                    <h3>${hint}</h3>
                    <div style="font-size: 2em; color: #667eea; font-weight: bold; margin: 15px 0;">
                        ${question}
                    </div>
                    <p style="color: #666; font-size: 0.9em;">æ„æ€ï¼š${randomVerb.meaning}</p>
                    <input type="text" id="irregularAnswer" placeholder="è¼¸å…¥ç­”æ¡ˆ" style="font-size: 18px; text-align: center; margin: 10px 0;">
                    <br>
                    <button class="btn" onclick="checkIrregularAnswer()">æª¢æŸ¥ç­”æ¡ˆ</button>
                    <button class="btn" onclick="showAnswer()" style="background: #6c757d;">é¡¯ç¤ºç­”æ¡ˆ</button>
                </div>
            `;
            
            document.getElementById('irregularAnswer').focus();
        }

        function checkIrregularAnswer() {
            const userAnswer = document.getElementById('irregularAnswer').value.trim().toLowerCase();
            const correctAnswer = currentIrregularTest.answer.toLowerCase();
            const isCorrect = userAnswer === correctAnswer || 
                             (correctAnswer.includes('/') && correctAnswer.split('/').some(ans => ans.trim() === userAnswer));
            
            irregularScore.total++;
            if (isCorrect) {
                irregularScore.correct++;
                playSound('correct');
            } else {
                playSound('error');
            }
            
            updateIrregularScore();
            showIrregularResult(isCorrect);
        }

        function showAnswer() {
            irregularScore.total++;
            playSound('error'); // é¡¯ç¤ºç­”æ¡ˆç®—éŒ¯èª¤
            updateIrregularScore();
            showIrregularResult(false, true);
        }

        function showIrregularResult(isCorrect, showedAnswer = false) {
            const verb = currentIrregularTest.verb;
            const userAnswer = document.getElementById('irregularAnswer').value.trim();
            
            let resultIcon = isCorrect ? 'âœ… æ­£ç¢ºï¼' : 'âŒ éŒ¯èª¤';
            if (showedAnswer) resultIcon = 'ğŸ’¡ ç­”æ¡ˆæ­æ›‰';
            
            document.getElementById('irregularDisplay').innerHTML = `
                <div style="text-align: center;">
                    <h3>${resultIcon}</h3>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin: 15px 0;">
                        <h4>${verb.meaning}</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin: 10px 0;">
                            <div>
                                <strong>åŸå½¢</strong><br>
                                <span style="color: #007bff;">${verb.base}</span>
                            </div>
                            <div>
                                <strong>éå»å¼</strong><br>
                                <span style="color: #28a745;">${verb.past}</span>
                            </div>
                            <div>
                                <strong>éå»åˆ†è©</strong><br>
                                <span style="color: #dc3545;">${verb.pp}</span>
                            </div>
                        </div>
                        ${!isCorrect && !showedAnswer ? `<p style="color: #666;">ä½ çš„ç­”æ¡ˆï¼š${userAnswer}</p>` : ''}
                    </div>
                    <button class="btn" onclick="continueIrregularTest()">ä¸‹ä¸€é¡Œ</button>
                    <button class="btn" onclick="startIrregularTest()" style="background: #28a745;">é‡æ–°é–‹å§‹</button>
                </div>
            `;
        }

        function continueIrregularTest() {
            const level = document.getElementById('irregularLevel').value;
            const mode = document.getElementById('practiceMode').value;
            const verbList = getVerbList(level);
            generateIrregularQuestion(verbList, mode);
        }

        function updateIrregularScore() {
            document.getElementById('irregularCorrect').textContent = irregularScore.correct;
            document.getElementById('irregularTotal').textContent = irregularScore.total;
            const rate = irregularScore.total > 0 ? Math.round((irregularScore.correct / irregularScore.total) * 100) : 0;
            document.getElementById('irregularRate').textContent = rate + '%';
        }

        function showVerbList() {
            const level = document.getElementById('irregularLevel').value;
            const verbList = getVerbList(level);
            
            let html = `<h3>ğŸ“š ${level === 'basic' ? 'åŸºç¤11å€‹' : level === 'intermediate' ? 'é€²éš39å€‹' : 'å…¨éƒ¨50å€‹'}ä¸è¦å‰‡å‹•è©</h3>`;
            html += '<div style="max-height: 400px; overflow-y: auto;">';
            
            // æ ¹æ“šå‹æ…‹åˆ†çµ„
            const aaaVerbs = verbList.filter(v => v.base === v.past && v.past === v.pp);
            const abbVerbs = verbList.filter(v => v.base !== v.past && v.past === v.pp);
            const abcVerbs = verbList.filter(v => v.base !== v.past && v.past !== v.pp && v.base !== v.pp);
            
            if (aaaVerbs.length > 0) {
                html += '<h4 style="color: #007bff;">AAAå‹ï¼ˆä¸‰æ…‹ç›¸åŒï¼‰</h4>';
                aaaVerbs.forEach(verb => {
                    html += `<div style="border: 1px solid #ddd; padding: 8px; margin: 5px 0; border-radius: 5px;">
                        <strong>${verb.base}</strong> - ${verb.past} - ${verb.pp} <span style="color: #666;">(${verb.meaning})</span>
                    </div>`;
                });
            }
            
            if (abbVerbs.length > 0) {
                html += '<h4 style="color: #28a745;">ABBå‹ï¼ˆéå»å¼=éå»åˆ†è©ï¼‰</h4>';
                abbVerbs.forEach(verb => {
                    html += `<div style="border: 1px solid #ddd; padding: 8px; margin: 5px 0; border-radius: 5px;">
                        <strong>${verb.base}</strong> - ${verb.past} - ${verb.pp} <span style="color: #666;">(${verb.meaning})</span>
                    </div>`;
                });
            }
            
            if (abcVerbs.length > 0) {
                html += '<h4 style="color: #dc3545;">ABCå‹ï¼ˆä¸‰æ…‹çš†ä¸åŒï¼‰</h4>';
                abcVerbs.forEach(verb => {
                    html += `<div style="border: 1px solid #ddd; padding: 8px; margin: 5px 0; border-radius: 5px;">
                        <strong>${verb.base}</strong> - ${verb.past} - ${verb.pp} <span style="color: #666;">(${verb.meaning})</span>
                    </div>`;
                });
            }
            
            html += '</div>';
            html += `<p style="margin-top: 15px; color: #666; font-size: 0.9em;">
                ğŸ’¡ å­¸ç¿’æŠ€å·§ï¼šå…ˆæŒæ¡å‹æ…‹åˆ†çµ„ï¼ŒAAAå‹æœ€å®¹æ˜“ï¼ŒABCå‹éœ€è¦å¤šç·´ç¿’ï¼
            </p>`;
            
            document.getElementById('irregularDisplay').innerHTML = html;
        }

        // åˆå§‹åŒ–
        updateWordCount();
        document.getElementById('questionCount').textContent = questions.length;
        updateLearningProgress(); // åˆå§‹åŒ–å­¸ç¿’é€²åº¦
        
        // æ·»åŠ å…¨åŸŸéŒ¯èª¤è™•ç†
        window.addEventListener('error', function(e) {
            console.error('ç™¼ç”ŸéŒ¯èª¤:', e.error);
        });
        
        // æ¸¬è©¦å‡½æ•¸æ˜¯å¦æ­£å¸¸å®šç¾©
        console.log('æ‡‰ç”¨å·²åˆå§‹åŒ–');
        console.log('å–®å­—æ•¸é‡:', vocabulary.length);
        console.log('å•é¡Œæ•¸é‡:', questions.length);
        console.log('éŒ¯é¡Œæ•¸é‡:', errors.length);
        console.log('ç­†è¨˜æ•¸é‡:', notes.length);
        
        // è«‹æ±‚é€šçŸ¥æ¬Šé™
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }
        
        // åˆå§‹åŒ–è¨ˆæ™‚å™¨é¡¯ç¤º
        resetTimer();
        
        // åˆå§‹åŒ–éŒ¯é¡Œçµ±è¨ˆ
        updateErrorStats();
        
        // éµç›¤äº‹ä»¶
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const activeElement = document.activeElement;
                if (activeElement.id === 'mathAnswer') {
                    checkMathAnswer();
                } else if (activeElement.id === 'irregularAnswer') {
                    checkIrregularAnswer();
                } else if (activeElement.id === 'reviewAnswer') {
                    // å¾activeElementæ‰¾åˆ°å°æ‡‰çš„éŒ¯é¡ŒID
                    const errorItem = activeElement.closest('.error-item');
                    if (errorItem) {
                        const buttons = errorItem.getElementsByTagName('button');
                        for (let btn of buttons) {
                            if (btn.textContent === 'æäº¤ç­”æ¡ˆ') {
                                btn.click();
                                break;
                            }
                        }
                    }
                } else if (activeElement.id === 'wordTestAnswer') {
                    checkWordAnswer();
                } else if (activeElement.id === 'exampleAnswer') {
                    checkExampleAnswer();
                } else if (activeElement.id === 'spellingAnswer') {
                    checkSpellingAnswer();
                } else if (activeElement.id === 'quizAnswer') {
                    checkQuizAnswer();
                }
            }
        });
    </script>
</body>
</html>
